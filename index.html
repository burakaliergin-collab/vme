<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>Verb Matrix v6.1 (Final Fix)</title>
    <link rel="stylesheet" href="style.css"> 
    <link rel="manifest" href="manifest.json">
</head>
<body>

    <div class="container">

        <div id="app-status-bar" style="position: sticky; top: 0; background: #333; color: white; padding: 10px; z-index: 1000; border-bottom: 2px solid #ff9800; display: flex; justify-content: space-between; align-items: center;">
    <div>
        <span id="status-verb" style="font-weight: bold; font-size: 1.2em; color: #ff9800;">FÄ°Ä°L SEÃ‡Ä°LMEDÄ°</span>
        <br>
        <span id="status-mode" style="font-size: 0.8em; color: #ccc;">Mod: - | Grup: -</span>
    </div>
    <button onclick="goHome()" style="background: #d32f2f; color: white; padding: 5px 10px; border: none; border-radius: 4px;">ANA MENÃœ</button>
</div>

<div class="container">
   </div>
        <div id="topNav" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <button class="icon-btn" id="musicToggleBtn" onclick="toggleMusic()">ğŸ”‡</button>
            <div style="font-weight:bold; color:var(--primary); font-size:1.1rem;" id="currentClassDisplay">A1</div>
            <button class="icon-btn" id="nightModeToggle" onclick="toggleNightMode()">ğŸŒ™</button>
        </div>

        <header style="text-align: center; margin-bottom: 20px;">
            <img id="appLogo" src="logo.png" alt="Logo" style="max-height: 50px; margin-bottom: 10px; display: none;">
            <h1 style="color: var(--primary); margin: 0;">VERB MATRIX</h1>
            <p style="color: #718096; font-size: 0.9rem;">Fiil OdaklÄ± Almanca Ã–ÄŸrenim Sistemi</p>
        </header>

        <div id="mainMenu" class="view active">
            <div class="card" style="text-align:center; padding:20px; margin-bottom:20px;">
                <h3>HoÅŸ Geldiniz!</h3>
                <p>Ã‡alÄ±ÅŸma yÃ¶nÃ¼nÃ¼ seÃ§ip baÅŸlayÄ±n.</p>
            </div>

            <div class="grid-menu">
                <button class="btn btn-secondary btn-lg" onclick="toggleLanguageMode()" style="flex-direction: column; align-items: flex-start; padding-left:30px;">
                    <div class="led-row" style="margin-bottom:5px;">
                        <span class="led-indicator active" id="led_tr_de"></span> ğŸ‡¹ğŸ‡· TR âœ ğŸ‡©ğŸ‡ª DE
                    </div>
                    <div class="led-row">
                        <span class="led-indicator" id="led_de_tr"></span> ğŸ‡©ğŸ‡ª DE âœ ğŸ‡¹ğŸ‡· TR
                    </div>
                </button>

                <button class="btn btn-primary btn-lg" onclick="showView('modeSelectionMenu')">
                    <div>ğŸ“š Konu Ã‡alÄ±ÅŸ</div>
                    <small style="opacity:0.8">SÄ±ralÄ± Ã–ÄŸrenim</small>
                </button>
                
                <button class="btn btn-danger btn-lg" onclick="showView('tekrarMenu')">
                    <div>ğŸ”„ Tekrar (SRS)</div>
                    <small style="opacity:0.8">Zor / Normal / Ã–ÄŸrendim</small>
                </button>
            </div>
        </div>

        <div id="modeSelectionMenu" class="view">
            <h3>Ã‡alÄ±ÅŸma YÃ¶ntemi</h3>
            <div class="grid-menu">
                <button class="btn btn-primary btn-lg" onclick="selectStudyMode('standard')">
                    <div>ğŸ“š Kategorize Et</div>
                    <small>GÃ¶r, Ã‡evir, Puanla</small>
                </button>
                <button class="btn btn-warning btn-lg" onclick="selectStudyMode('parallel')">
                    <div>ğŸ§ Paralel Dinleme</div>
                    <small>SÄ±ralÄ± Dinle ve PekiÅŸtir</small>
                </button>
            </div>
        </div>

        <div id="classSelectionView" class="view">
            <h3>SÄ±nÄ±f SeÃ§imi</h3>
            <div id="classGrid" class="grid-menu"></div>
        </div>
        <div id="mixedTopicSelectionView" class="view">
            <h3>Konu Havuzu</h3>
            <div id="mixedTopicList" class="list-container"></div>
            <button class="btn btn-success btn-block" style="margin-top:20px;" onclick="saveMixedSelection()">ğŸ’¾ KAYDET VE Ã‡IK</button>
        </div>
        <div id="groupMenu" class="view">
            <h3>Konu Grubu SeÃ§</h3>
            <div id="groupList" class="list-container"></div>
        </div>
        <div id="verbMenu" class="view">
            <h3>Fiil SeÃ§</h3>
            <div id="verbList" class="list-container"></div>
        </div>
        <div id="sectionMenu" class="view">
            <h3>Konu SeÃ§</h3>
            <div id="sectionList" class="list-container"></div>
        </div>
        
        <div id="learningView" class="view">
            <div class="progress-bar-wrapper">
                <div id="progressBar" class="progress-fill"></div>
            </div>
            <div style="text-align:right; font-size:0.8rem; color:#718096; margin-bottom:10px;">
                <span id="learnProgressText">0/0</span>
            </div>

            <div id="learningContent" class="flashcard"></div>

            <div id="wordOrderArea" class="hidden">
                <div class="word-order-area">
                    <div id="wordSelectedArea" class="word-selected"></div>
                    <div id="wordPoolArea" class="word-pool"></div>
                </div>
                <div id="wordOrderResult" class="card hidden" style="text-align:center; font-weight:bold; margin:10px 0;"></div>
            </div>
            <div id="quizResultArea" class="result hidden" style="margin-top:20px; text-align:center;"></div>
            <div id="clozeResultArea" class="result hidden" style="margin-top:20px; text-align:center;"></div>
            
            <div id="srsControls" class="grid-3 hidden" style="margin-top:15px; margin-bottom: 15px;">
                <button class="btn btn-danger" onclick="rateCard('zor')">ZOR</button>
                <button class="btn btn-warning" onclick="rateCard('normal')">NORMAL</button>
                <button class="btn btn-success" onclick="rateCard('ogrendim')">Ã–ÄRENDÄ°M</button>
            </div>

            <button id="actionBtn" class="btn btn-primary btn-block" style="margin-top:10px; padding:15px; font-size:1.1rem;" onclick="handleAction()">GÃ–STER</button>

            <div id="learningControlsArea" style="margin-top: 20px; border-top: 1px solid #eee; padding-top: 15px;">
                <div class="learning-controls-main" style="display:flex; justify-content:space-between; gap:10px; margin-bottom:10px;">
                    <button class="btn btn-info btn-sm" onclick="toggleLearningPanel('panelHint')">ğŸ’¡ Ä°pucu</button>
                    <button class="btn btn-primary btn-sm" onclick="toggleLearningPanel('panelListen')">ğŸ”Š Dinle</button>
                    <button id="btnEditCard" class="btn btn-secondary btn-sm" onclick="toggleLearningPanel('panelEdit')">âœï¸ DÃ¼zenle</button>
                </div>

                <div id="panelHint" class="learning-controls-panel hidden" style="padding:15px;">
                    <div class="hint-types" style="display:flex; gap:10px; margin-bottom:10px; justify-content:center;">
                        <button class="btn btn-info btn-sm" onclick="showSpecificHint('sentence')">CÃ¼mle</button>
                        <button class="btn btn-info btn-sm" onclick="showSpecificHint('topic')">Konu</button>
                        <button class="btn btn-secondary btn-sm" onclick="showSpecificHint('verb')">Fiil</button>
                    </div>
                    <div id="hintTextDisplay" style="padding:10px; background:#fffbeb; color:#9c4221; border-radius:6px; min-height:40px; font-weight:500;">Ä°pucu seÃ§in.</div>
                </div>

                <div id="panelListen" class="learning-controls-panel hidden" style="padding:15px;">
                    <div style="display:flex; justify-content:center; gap:15px; margin-bottom:15px;">
                        <button id="btnAutoPlay" class="led-btn active" onclick="toggleAutoPlay()">
                            <span class="led-indicator active" id="autoPlayLed"></span> Otomatik
                        </button>
                        <button id="btnSlowMode" class="led-btn" onclick="toggleSlowMode()">
                            <span class="led-indicator" id="slowModeLed"></span> YavaÅŸ Mod
                        </button>
                    </div>
                    <div class="button-group-row" style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                         <button class="btn btn-secondary" onclick="playCurrentSentence('de')">ğŸ‡©ğŸ‡ª Oku</button>
                         <button class="btn btn-secondary" onclick="playCurrentSentence('tr')">ğŸ‡¹ğŸ‡· Oku</button>
                    </div>
                </div>

                <div id="panelEdit" class="learning-controls-panel hidden" style="padding: 15px;"></div>
            </div>
        </div>

        <div id="tekrarMenu" class="view">
            <h3>Tekrar Merkezi</h3>
            <div class="list-container">
                <button class="btn btn-danger-light list-btn" onclick="startTekrar('zor')">
                    ğŸ”¥ ZorlandÄ±klarÄ±m <span class="badge" id="tekrarCountZor">0</span>
                </button>
                <button class="btn btn-warning-light list-btn" onclick="startTekrar('normal')">
                    âš–ï¸ Normal <span class="badge" id="tekrarCountNormal">0</span>
                </button>
                <button class="btn btn-success-light list-btn" onclick="startTekrar('ogrendim')">
                    âœ… Ã–ÄŸrendiklerim <span class="badge" id="tekrarCountOgrenildi">0</span>
                </button>
            </div>
        </div>

        <div id="tekrarModeMenu" class="view">
            <h3 id="tekrarModeTitle">Mod SeÃ§in</h3>
            <div class="grid-menu">
                <button class="btn btn-warning" onclick="startQuizMode('parallel')">ğŸ§ Paralel Dinleme</button>
                <button class="btn btn-danger" onclick="startQuizMode('quiz')">ğŸ“ Quiz (Yazma)</button>
                <button class="btn btn-primary" onclick="startQuizMode('wordorder')">ğŸ§© Kelime SÄ±ralama</button>
                <button class="btn btn-info" onclick="startQuizMode('cloze')">âœï¸ BoÅŸluk Doldurma</button>
            </div>
        </div>

        <div id="storyView" class="view">
            <div class="card">
                <h3 id="storyTitle" style="color:var(--primary); text-align:center;"></h3>
                <div id="storyContent" style="white-space: pre-wrap; line-height:1.6; font-size:1.1rem; padding:10px;"></div>
                <div style="margin-top:20px; display:flex; gap:10px;">
                    <button class="btn btn-secondary" onclick="playStoryAudio()">ğŸ”Š Oku</button>
                    <button class="btn btn-primary" onclick="goBackInHistory()">Kapat</button>
                </div>
            </div>
        </div>

        <div id="settingsView" class="view">
            <h3>Veri YÃ¶netimi</h3>
            <div class="card" style="text-align:center;">
                <h4 style="margin-bottom:10px; color:var(--primary);">ğŸ“Š Genel Ä°lerleme</h4>
                <div class="progress-bar-wrapper" style="height:12px; margin-bottom:5px;">
                    <div id="totalProgressBar" class="progress-fill" style="width:0%"></div>
                </div>
                <div style="font-size:0.9rem; font-weight:bold; color:#718096;">
                    <span id="totalProgressText">0 / 0</span> Kelime Ã–ÄŸrenildi
                </div>
            </div>
            <div class="card">
                <h4 style="margin-bottom:15px;">ğŸ’¾ Ä°lerleme KayÄ±tlarÄ±</h4>
                <input type="file" id="jsonInput" accept=".json" style="display:none" onchange="window.handleImport(event)">
                <button class="btn btn-primary btn-block" style="margin-bottom:10px;" onclick="document.getElementById('jsonInput').click()">ğŸ“¥ Ä°lerleme YÃ¼kle (JSON)</button>
                <button class="btn btn-secondary btn-block" onclick="window.exportData()">ğŸ“¤ Ä°lerleme Ä°ndir (Yedekle)</button>
            </div>
            <div class="card">
                <h4 style="margin-bottom:15px;">ğŸ› ï¸ Sistem</h4>
                <button class="btn btn-info btn-block" style="margin-bottom:10px;" onclick="window.forceUpdateApp()">ğŸ”„ UygulamayÄ± GÃ¼ncelle</button>
                <button class="btn btn-danger btn-block" style="margin-bottom:20px;" onclick="window.resetProgress()">âš ï¸ TÃ¼m Ä°lerlemeyi SÄ±fÄ±rla</button>
                <button id="installAppBtn" class="btn btn-success btn-block hidden" onclick="installPWA()">ğŸ“² UygulamayÄ± Kur</button>
                <div id="iosInstallInfo" class="hidden" style="background:#f0f9ff; padding:10px; border-radius:8px; border:1px solid #bae6fd; font-size:0.9rem;">
                    ğŸ“± <b>iOS Ä°Ã§in:</b> PaylaÅŸ > Ana Ekrana Ekle
                </div>
            </div>
        </div>

        <div id="parallelPlayerView" class="view"></div>
        <div id="storyQuestionsView" class="view"></div>

    </div>

    <div class="floating-nav">
        <button class="float-btn" onclick="goBackInHistory()">ğŸ”™</button>
        <button class="float-btn" onclick="showView('mainMenu')">ğŸ </button>
        <button class="float-btn" onclick="showView('settingsView')">âš™ï¸</button>
        <button class="float-btn" id="classNavBtn" style="font-size:0.9rem; font-weight:bold; background:var(--primary); color:white; border-color:var(--primary-dark);" onclick="showView('classSelectionView')">A1</button>
    </div>

    <audio id="bgMusic" loop><source src="telifsiz-klasik.mp3" type="audio/mpeg"></audio>
    <script src="script.js"></script>
</body>
</html>
