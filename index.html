<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Verb Matrix â€” v3.9 (AkÄ±llÄ± Ä°lerleme & BaÅŸlÄ±k)</title>

<link rel="icon" href="favicon.ico" type="image/x-icon">
<link rel="manifest" href="manifest.json"> 
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#667eea">

<style>
  /* --- Genel --- */
  *{box-sizing:border-box;margin:0;padding:0}
  body{font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); min-height:100vh;padding:18px; transition: background .25s,color .25s; min-width: 100%;}
  .container{max-width:1200px;margin:0 auto;background:#fff;border-radius:16px;padding:28px;box-shadow:0 18px 50px rgba(0,0,0,.18);transition:background .25s,color .25s}
  header{text-align:center;margin-bottom:18px}
  .subtitle{color:#6b7280;margin-top:6px}

  /* BÃ¶lÃ¼m BaÅŸlÄ±ÄŸÄ± */
  .section-title{font-size:1.25rem;color:#2d3748;margin:16px 0 10px;padding-bottom:8px;border-bottom:3px solid #667eea;font-weight:700}
  
  /* YENÄ° (v3.9): Dinamik BaÅŸlÄ±k iÃ§in alt baÅŸlÄ±k stili */
  .section-subtitle {
    font-size: 0.95rem;
    color: #4a5568;
    font-weight: 500;
    margin: -8px 0 10px 0;
  }

  /* MODU SEÃ‡ iÃ§in bÃ¼yÃ¼k, ortalanmÄ±ÅŸ stil */
  .large-centered-title {
    text-align: center;
    font-size: 2.5rem;
    color: #2d3748;
    font-weight: 800;
    margin: 24px 0;
    text-transform: uppercase;
  }

  .button-grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));margin:12px 0}

  /* GÃœNCELLEME (v3.8): Ana MenÃ¼ ButonlarÄ± artÄ±k diÄŸerleriyle aynÄ± boyutta */
  #mainMenu .button-grid {
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 12px;
  }
  
  /* GRUP SEÃ‡Ä°M BAÅLIKLARI */
  .group-select-header { text-align: center; margin-bottom: 24px; padding-top: 18px; }
  .group-select-header h2 { font-size: 2.5rem; color: #2d3748; font-weight: 800; letter-spacing: 2px; margin-bottom: 18px; }
  .group-select-columns { display: flex; justify-content: space-between; margin-bottom: 12px; }
  .group-column-title { font-size: 1.4rem; color: #2d3748; font-weight: 700; display: inline-block; padding: 0 10px 8px; border-bottom: 3px solid #667eea; }

  /* --- GENEL BUTON STÄ°LLERÄ° --- */
  .btn{
    padding:10px 14px;
    border-radius:10px;
    font-weight:700;
    cursor:pointer;
    color:#fff;
    text-align: left;
    display:flex;
    align-items:center;
    transition: all .15s ease; 
    border-width: 1px;
    border-style: solid;
    box-shadow: 0 2px 4px rgba(0,0,0,0.15), inset 0 1px 1px rgba(255,255,255,0.3);
    text-shadow: 0 1px 1px rgba(0,0,0,0.2);
  }
  .btn:active {
    transform: translateY(1px);
    box-shadow: 0 1px 2px rgba(0,0,0,0.2), inset 0 1px 1px rgba(0,0,0,0.1);
  }

  .btn-small{padding:8px 10px;font-size:.9rem}

  /* RENKLER */
  .btn-danger { background: linear-gradient(to bottom, #f87171 0%, #f56565 100%); border-color: #e53e3e; }
  .btn-danger:hover { background: linear-gradient(to bottom, #f56565 0%, #e53e3e 100%); }
  .btn-primary { background: linear-gradient(to bottom, #7a8efb 0%, #667eea 100%); border-color: #5a6ed0; }
  .btn-primary:hover { background: linear-gradient(to bottom, #667eea 0%, #5a6ed0 100%); }
  .btn-secondary { background: linear-gradient(to bottom, #cacedb 0%, #aeb4c5 100%); color: #1e293b; border-color: #949daf; text-shadow: 0 1px 0 rgba(255,255,255,0.3); }
  .btn-secondary:hover { background: linear-gradient(to bottom, #aeb4c5 0%, #949daf 100%); }
  .btn-info { background: linear-gradient(to bottom, #4fd1c5 0%, #38b2ac 100%); border-color: #319795; }
  .btn-info:hover { background: linear-gradient(to bottom, #38b2ac 0%, #319795 100%); }
  .btn-warning { background: linear-gradient(to bottom, #fbd38d 0%, #ecc94b 100%); color: #1e293b; border-color: #d69e2e; text-shadow: 0 1px 0 rgba(255,255,255,0.2); }
  .btn-warning:hover { background: linear-gradient(to bottom, #ecc94b 0%, #d69e2e 100%); }
  .btn-srs-zor { background: linear-gradient(to bottom, #f87171 0%, #f56565 100%); border-color: #e53e3e; }
  .btn-srs-zor:hover { background: linear-gradient(to bottom, #f56565 0%, #e53e3e 100%); }
  .btn-srs-normal { background: linear-gradient(to bottom, #fbd38d 0%, #ecc94b 100%); color: #1e293b; border-color: #d69e2e; text-shadow: 0 1px 0 rgba(255,255,255,0.2); }
  .btn-srs-normal:hover { background: linear-gradient(to bottom, #ecc94b 0%, #d69e2e 100%); }
  .btn-srs-ogrendim { background: linear-gradient(to bottom, #68d391 0%, #48bb78 100%); border-color: #38a169; }
  .btn-srs-ogrendim:hover { background: linear-gradient(to bottom, #48bb78 0%, #38a169 100%); }
  .btn-ai { background: linear-gradient(to bottom, #6366f1 0%, #4f46e5 100%); border-color: #4338ca; }
  .btn-ai:hover { background: linear-gradient(to bottom, #4f46e5 0%, #4338ca 100%); }

  /* GÃœNCELLEME (v3.8): Ã‡alÄ±ÅŸma SayfasÄ± Buton Gridi (SadeleÅŸtirildi) */
  .button-grid-learning {
      display: grid;
      gap: 10px;
      /* 3 Ana Kategori butonu iÃ§in 3 sÃ¼tun */
      grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); 
      margin-top: 15px;
  }
  .button-grid-learning .btn {
      justify-content: center; /* Metni ortala */
      font-size: 0.9rem;
      font-weight: 700;
  }
  /* Alt paneller iÃ§in stil */
  .sub-panel-grid {
      display: none; /* JS ile aÃ§Ä±lacak */
      gap: 8px;
      /* Panel 3 ana butonun altÄ±na tam geniÅŸlikte yayÄ±lsÄ±n */
      grid-column: 1 / -1; 
      /* Ä°Ã§erik butonlarÄ± (Ã¶rn: Dinle butonlarÄ±) */
      grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
      
      background: rgba(0,0,0,0.05);
      padding: 10px;
      border-radius: 8px;
      margin-top: -5px; /* Ana butona yapÄ±ÅŸsÄ±n */
  }
  .sub-panel-grid.active {
      display: grid; /* JS ile .active eklendiÄŸinde gÃ¶rÃ¼nÃ¼r yap */
  }
  /* Ana Kategori ButonlarÄ±nÄ±n Rengi */
  .btn-category-toggle {
      background: #aeb4c5; /* Pastel Gri/Mavi */
      color: #1e293b;
  }
  .btn-category-toggle:hover { background: #949daf; }
  /* GÃœNCELLEME SONU (v3.8) */
  

  .btn.disabled, .btn:disabled{background:#cbd5e1;color:#718096;cursor:not-allowed;opacity:0.7}
  .hidden { display: none; }
  .view{display:none}
  .view.active{display:block;animation:slideIn .18s ease}
  @keyframes slideIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
  .group-story-grid { display: grid; gap: 12px; grid-template-columns: 1fr 1fr; }
  .group-story-grid .btn { justify-content: center; text-align: center; flex-direction: column; height: 60px; }
  .button-group-row { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 12px; }
  .button-group-row .btn { justify-content: center; }
  #modeMenu .button-group-row, 
  #tekrarModeMenu .button-group-row { justify-content: center; }
  .button-grid .btn { justify-content: center; }

  /* LED GÃ¶sterge */
  .led-indicator {
    display: inline-block;
    width: 11px;
    height: 11px;
    border-radius: 50%;
    background-color: #555;
    border: 1px solid #333;
    margin-right: 7px;
    vertical-align: middle;
    transition: background-color 0.2s, box-shadow 0.2s;
    flex-shrink: 0;
  }
  .led-indicator.active {
    background-color: #39e75f;
    box-shadow: 0 0 6px #39e75f, 0 0 3px rgba(255,255,255,0.5) inset;
    border-color: #2b9e44;
  }
  
  /* GÃœNCELLEME (v3.8): Ã‡eviri ButonlarÄ± artÄ±k diÄŸerleriyle aynÄ± boyutta */
  .conversion-btn {
      min-width: 200px; /* Min geniÅŸlik kalsÄ±n */
      display: flex;
      align-items: center;
      justify-content: center; 
      text-align: center;
  }

  /* SRS Kontrol ButonlarÄ± (3'lÃ¼) */
  #srsControls {
      display: none;
      justify-content: space-around;
      margin-top: 15px;
      gap: 10px;
  }
  #srsControls .btn {
      flex: 1;
      margin: 0;
      justify-content: center;
      font-size: 1rem;
      padding: 12px 8px;
  }

  .mode-toggle{position:fixed;right:18px;top:18px;border-radius:50%;padding:10px;border:0;background:#fff;cursor:pointer;box-shadow:0 10px 28px rgba(0,0,0,.12);z-index:1200}
  .home-float-btn {
    position: fixed;
    right: 18px;
    bottom: 18px;
    border-radius: 50%;
    padding: 10px;
    border: 0;
    background: #fff;
    color: #333;
    cursor: pointer;
    box-shadow: 0 10px 28px rgba(0,0,0,.12);
    z-index: 1200;
    font-size: 1.4rem;
    line-height: 1;
    width: 48px;
    height: 48px;
    display: none;
  }
  .admin-float-btn {
    position: fixed;
    right: 18px;
    bottom: 80px;
    border-radius: 50%;
    padding: 10px;
    border: 0;
    background: #4a5568;
    color: #fff;
    cursor: pointer;
    box-shadow: 0 10px 28px rgba(0,0,0,.12);
    z-index: 1200;
    font-size: 1.4rem;
    line-height: 1;
    width: 48px;
    height: 48px;
    display: none;
  }

  .lang-btn{padding:8px 12px;border-radius:8px;border:2px solid #667eea;background:#fff;color:#667eea;cursor:pointer}
  .lang-btn.active{background:#667eea;color:#fff}
  .score-display{font-size:1.6rem;font-weight:800;color:#667eea;text-align:center;margin:12px 0}
  .small-muted{color:#6b7280;font-size:.9rem}
  .toggle-hint-btn{padding:8px 10px;border-radius:8px;border:0;background:#34495e;color:#fff;cursor:pointer}
  .content-box{background:#f9fafb;padding:16px;border-radius:12px;margin:12px 0;border-left:5px solid #667eea}
  .input-field, .textarea-field {width:100%;padding:10px;border-radius:8px;border:2px solid #e5e7eb;margin-top:8px;font-size:1rem;background:#fff;color:#0f1724}
  .select-field{width:100%;padding:10px;border-radius:8px;border:2px solid #e5e7eb;background:#fff;color:#0f1724; margin-top: 8px;}
  .progress-container{margin:12px 0}
  .progress-bar{height:28px;background:#e6eefc;border-radius:14px;overflow:hidden}
  .progress-fill{height:100%;background:linear-gradient(90deg,#667eea,#764ba2);width:0;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800; transition: width .2s;}

  .sentence{padding:12px;border-radius:8px;background:#fff;border-left:4px solid #667eea;margin:10px 0;font-weight:700;color:#0f1724; text-align: center;}
  #learningContent .sentence { font-size: 1.6rem; line-height: 1.4; }
  #learningContent #answerDisplay.sentence { font-size: 1.3rem; line-height: 1.4; background: #f0f4f8; }

  .word-order-area { display: flex; flex-direction: column; gap: 12px; flex-wrap: nowrap; justify-content: center; align-items: center; padding: 10px 0; }
  .word-pool, .word-selected { width: 95%; min-width: 95%; text-align: center; border: 1px solid #ddd; border-radius: 8px; padding: 8px; }
  .word-item{display:inline-block;padding:8px 12px;border-radius:8px;background:#667eea;color:#fff;margin:6px;cursor:pointer;user-select:none}
  .word-item.top{background:#10b981}
  .word-item.disabled{background:#cbd5e1;color:#2d3748;cursor:not-allowed}

  .hint-area{margin-top:10px}
  .hint-item{background:#e6f3ff;padding:10px;border-left:4px solid #4299e1;border-radius:8px;margin:8px 0;color:#0f1724}
  .result{padding:10px;border-radius:8px;margin:8px 0;font-weight:700}
  .result.correct{background:#c6f6d5;color:#22543d;border-left:4px solid #48bb78}
  .result.incorrect{background:#fed7d7;color:#742a2a;border-left:4px solid #f56565}

  .progress-stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 12px;
    text-align: center;
    margin: 20px 0;
  }
  .stat-card { background: #f9fafb; padding: 20px 15px; border-radius: 12px; }
  .stat-card h4 { font-size: 1.1rem; color: #4a5568; margin-bottom: 8px; }
  .stat-card .stat-value { font-size: 2.5rem; font-weight: 800; }
  .stat-card-zor .stat-value { color: #f56565; }
  .stat-card-normal .stat-value { color: #d69e2e; }
  .stat-card-ogrendim .stat-value { color: #48bb78; }

  /* GECE MODU */
  body.night-mode{background:linear-gradient(135deg,#0f1724 0%,#071226 100%);color:#e6eef8}
  body.night-mode .container{background:#071226;color:#e6eef8;box-shadow:none}
  body.night-mode .section-title{border-bottom-color:#3b82f6;color:#e6eef8}
  body.night-mode .section-subtitle{color: #9ca3af;}
  body.night-mode .large-centered-title{color: #e6eef8;}
  body.night-mode .group-column-title{color: #e6eef8;border-bottom-color: #3b82f6;}
  body.night-mode .content-box{background:#071831;border-left-color:#3b82f6}
  body.night-mode .input-field, .night-mode .textarea-field, .night-mode .select-field{background:#041226;color:#e6eef8;border-color:#082036}
  body.night-mode .sentence{background:#071226;color:#e6eef8;border-left-color:#3b82f6}
  body.night-mode #learningContent #answerDisplay.sentence { background: #0f2742; }
  body.night-mode .word-item{background:#3b82f6;color:#fff}
  body.night-mode .word-item.top{background:#10b981}
  body.night-mode .hint-item{background:#052033;color:#c8ecff;border-left-color:#3b82f6}
  body.night-mode .stat-card { background: #071831; }
  body.night-mode .stat-card h4 { color: #9ca3af; }
  body.night-mode .btn-primary { background: #3b82f6; }
  body.night-mode .btn-primary:hover { background: #2563eb; }
  body.night-mode .btn-secondary { background: #334155; color: #e2e8f0; }
  body.night-mode .btn-secondary:hover { background: #475569; }
  body.night-mode .btn-info { background: #0d9488; }
  body.night-mode .btn-info:hover { background: #0f766e; }
  body.night-mode .btn-warning { background: #d97706; color: #fff; }
  body.night-mode .btn-warning:hover { background: #b45309; }
  body.night-mode .btn-ai { background: #6366f1; border-color: #4f46e5; }
  body.night-mode .btn-ai:hover { background: #4f46e5; }
  body.night-mode .btn.disabled, body.night-mode .btn:disabled {background:#1f2937;color:#4b5563;}
  body.night-mode .toggle-hint-btn{ background:#1f2937 }
  body.night-mode .group-story-grid .btn .small-muted { color: #9ca3af; }
  
  /* Gece Modu - Yeni Buton Paneli (v3.8) */
  body.night-mode .btn-category-toggle { background: #334155; color: #e2e8f0; }
  body.night-mode .btn-category-toggle:hover { background: #475569; }
  body.night-mode .sub-panel-grid { background: rgba(0,0,0,0.2); }
  body.night-mode .button-grid-learning .btn-danger { background: #f56565; color: #fff; } /* KÄ±rmÄ±zÄ±yÄ± koru */


  /* Ä°pucu Detay GÃ¶rÃ¼nÃ¼mÃ¼ Stili */
  #hintDetailView {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg,#667eea 0%,#764ba2 100%);
    z-index: 1500;
    overflow-y: auto;
    padding: 20px;
    display: none;
  }
  #hintDetailView.active { display: block; }
  #hintDetailView .container {
    max-width: 800px;
    margin: 40px auto;
    background: #fff;
    padding: 30px;
    border-radius: 16px;
    box-shadow: 0 0 20px rgba(0,0,0,0.3);
  }
  #hintDetailView h2 { text-align: center; color: #667eea; margin-bottom: 20px; border-bottom: 3px solid #667eea; padding-bottom: 10px; }
  #hintDetailView .hint-content-box { background: #f0f4f8; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 5px solid #667eea; font-size: 1.1rem; line-height: 1.6; white-space: pre-wrap; }
  body.night-mode #hintDetailView { background: linear-gradient(135deg,#0f1724 0%,#071226 100%); }
  body.night-mode #hintDetailView .container { background: #071226; color: #e6eef8; box-shadow: none; }
  body.night-mode #hintDetailView h2 { color: #3b82f6; border-bottom-color: #3b82f6; }
  body.night-mode #hintDetailView .hint-content-box { background: #0f2742; border-left-color: #3b82f6; color: #e6eef8; }
  
  /* MÃ¼zik Ã‡alar Stilleri */
  .music-player-container {
    position: fixed;
    left: 18px;
    top: 18px;
    z-index: 1200;
    background: rgba(255, 255, 255, 0.9);
    border-radius: 25px;
    padding: 5px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, .1);
    display: flex;
    align-items: center;
    transition: background .25s;
  }
  .music-toggle-btn { border: 0; background: #667eea; color: #fff; border-radius: 50%; width: 38px; height: 38px; font-size: 1.2rem; cursor: pointer; z-index: 2; }
  .music-volume-slider { display: none; margin-left: 8px; margin-right: 10px; width: 80px; vertical-align: middle; z-index: 1; transition: opacity 0.3s; }
  .music-player-container:hover .music-volume-slider { display: inline-block; }
  body.night-mode .music-player-container { background: rgba(31, 41, 55, 0.9); }
  body.night-mode .music-toggle-btn { background: #3b82f6; }

  /* GÃ¶ster butonunu ortalamak iÃ§in */
  .primary-action-container {
    display: flex;
    justify-content: center;
    margin-top: 15px;
    margin-bottom: 8px;
  }
  .primary-action-container .btn {
    padding: 12px 24px;
    font-size: 1.1rem;
    min-width: 200px;
    justify-content: center;
    text-align: center;
  }
  /* (v3.8) 'GÃ¶ster' butonu iÃ§in Ã¶zel stil (AÃ§Ä±k renk) */
  #actionBtn.btn-show {
    background: #aeb4c5;
    color: #1e293b;
  }
  #actionBtn.btn-show:hover { background: #949daf; }
  body.night-mode #actionBtn.btn-show { background: #334155; color: #e2eef0; }
  body.night-mode #actionBtn.btn-show:hover { background: #475569; }
  
  /* MOBÄ°L CÄ°HAZ GÃ–RÃœNÃœM DÃœZELTMESÄ° */
  @media(max-width:768px){
    .container{padding:14px}
    .button-grid, 
    #mainMenu .button-grid, 
    .group-story-grid { 
        grid-template-columns: 1fr !important; /* Tek sÃ¼tun ve tam geniÅŸlik */
    } 
    /* Ã–ÄŸrenme ekranÄ± butonlarÄ±nÄ± da tek sÃ¼tun yap (v3.8) */
    .button-grid-learning {
        grid-template-columns: 1fr !important;
    }
    .sub-panel-grid {
        grid-template-columns: 1fr 1fr !important; /* Alt panel butonlarÄ± 2'li kalsÄ±n */
    }
    
    #mainMenu .btn { height: auto; padding: 16px; font-size: 1.2rem; }
    .conversion-btn { min-width: 100% !important; padding: 18px 10px !important; }
  }
  
  /* YENÄ° (v3.8): Toast Notification (Bilgi MesajÄ±) */
  #toastNotification {
    display: none;
    position: fixed;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    background-color: #333;
    color: #fff;
    padding: 16px 24px;
    border-radius: 8px;
    z-index: 2000;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    font-weight: 700;
    opacity: 0;
    transition: opacity 0.3s, bottom 0.3s;
  }
  #toastNotification.show {
    display: block;
    opacity: 1;
    bottom: 50px;
  }
  #toastNotification.success {
    background: linear-gradient(to bottom, #68d391 0%, #48bb78 100%);
    border-color: #38a169;
    color: #fff;
    text-shadow: 0 1px 1px rgba(0,0,0,0.2);
  }
  #toastNotification.error {
    background: linear-gradient(to bottom, #f87171 0%, #f56565 100%);
    border-color: #e53e3e;
    color: #fff;
    text-shadow: 0 1px 1px rgba(0,0,0,0.2);
  }
  
</style>
</head>
<body>
<button id="modeToggleBtn" class="mode-toggle" title="Gece/GÃ¼ndÃ¼z toggle">ğŸŒ™</button>

<button id="floatingHomeBtn" class="home-float-btn" title="Ana MenÃ¼" onclick="showView('mainMenu')">ğŸ </button>
<button id="floatingAdminBtn" class="admin-float-btn" title="YÃ¶netici" onclick="showView('adminView')">ğŸ”§</button>
<div id="musicPlayerContainer" class="music-player-container">
    <button id="musicToggleBtn" class="music-toggle-btn" title="MÃ¼zik Ã‡al/Durdur">ğŸ”Š</button>
    <input type="range" id="musicVolumeSlider" min="0" max="100" value="70" class="music-volume-slider" style="display: none;">
</div>
<div class="container">
  <header>
    <img src="logo.png" alt="Verb Matrix Logo" style="max-width: 280px; height: auto; margin: 10px auto 0; display: block;">
    <div class="subtitle" id="appSubtitle" data-translate-key="app.subtitle">Fiiller Ä°le Almanca Ã–ÄŸrenme Platformu</div>
  </header>

  <div id="mainMenu" class="view active">
    <div class="button-grid">
      <button class="btn btn-primary" id="btnCalis" data-translate-key="menu.calis" onclick="loadAndShowGroupMenu()">ğŸ“š Ã‡alÄ±ÅŸ</button>
      <button class="btn btn-info" id="btnTekrar" data-translate-key="menu.tekrar" onclick="showView('tekrarMenu')">ğŸ”„ Tekrar</button>
      <button class="btn btn-warning" id="btnProgress" data-translate-key="menu.progress" onclick="showView('progress')">ğŸ“Š Ä°lerleme</button>
      <button class="btn btn-secondary" id="btnSettings" data-translate-key="menu.settings" onclick="showView('settings')">âš™ï¸ Ayarlar</button>
    </div>
  </div>

  <div id="tekrarMenu" class="view">
    <h2 class="large-centered-title" data-translate-key="titles.tekrar">ğŸ”„ TEKRAR</h2>
    <div class="button-grid">
      <button class="btn btn-srs-zor" onclick="startTekrar('zor')">
        <span data-translate-key="srs.zorlandiklarim">ZORLANDIKLARIM</span> (<span id="tekrarCountZor">0</span>)
      </button>
      <button class="btn btn-srs-normal" onclick="startTekrar('normal')">
        <span data-translate-key="srs.normal">NORMAL</span> (<span id="tekrarCountNormal">0</span>)
      </button>
      <button class="btn btn-srs-ogrendim" onclick="startTekrar('ogrendim')">
        <span data-translate-key="srs.ogrendiklerim">Ã–ÄRENDÄ°KLERÄ°M</span> (<span id="tekrarCountOgrenildi">0</span>)
      </button>
    </div>
    <div class="button-group-row">
      <button class="btn btn-danger btn-small" onclick="showView('mainMenu')" data-translate-key="buttons.mainMenu">â† Ana MenÃ¼</button>
    </div>
  </div>

  <div id="tekrarModeMenu" class="view">
    <h2 class="large-centered-title" id="tekrarModeTitle">TEKRAR MODU</h2>
    <div class="content-box" style="margin-bottom: 20px;">
      <h4 data-translate-key="titles.conversionSelect">Ã‡eviri YÃ¶nÃ¼nÃ¼ SeÃ§in:</h4>
      <div class="button-group-row">
        <button class="btn conversion-btn btn-primary" id="tekrarModeTRDE" onclick="setConversionMode('tr-de'); startTekrarModePrompt()">
            <span class="led-indicator" style="margin-right: 12px;"></span> ğŸ‡¹ğŸ‡· TR â†’ DE ğŸ‡©ğŸ‡ª
        </button>
        <button class="btn conversion-btn btn-info" id="tekrarModeDETR" onclick="setConversionMode('de-tr'); startTekrarModePrompt()">
            <span class="led-indicator" style="margin-right: 12px;"></span> ğŸ‡©ğŸ‡ª DE â†’ TR ğŸ‡¹ğŸ‡·
        </button>
      </div>
    </div>
    <div class="button-grid">
      <button class="btn btn-secondary" onclick="startTekrarMode('cloze')">ğŸ”² <span data-translate-key="modes.cloze">BoÅŸluk Doldurma</span></button>
      <button class="btn btn-secondary" onclick="startTekrarMode('wordorder')">ğŸ”¤ <span data-translate-key="modes.wordorder">Kelimeleri SÄ±ralama</span></button>
      <button class="btn btn-primary" onclick="startTekrarMode('quiz')">ğŸ¯ <span data-translate-key="modes.quiz">Quiz (Test)</span></button>
    </div>
    <div class="button-group-row">
      <button class="btn btn-danger btn-small" onclick="showView('tekrarMenu')" data-translate-key="buttons.goBack">â† Geri</button>
    </div>
  </div>

  <div id="groupMenu" class="view">
    <div class="group-select-header">
      <h2 data-translate-key="titles.start">BAÅLA</h2>
    </div>
    <div class="group-select-columns">
      <div class="group-column-title-container">
        <div class="group-column-title" data-translate-key="titles.groupSelect">Fiil SeÃ§</div>
      </div>
      <div class="group-column-title-container">
        <div class="group-column-title" data-translate-key="titles.storySelect">Hikaye SeÃ§</div>
      </div>
    </div>
    <div id="groupButtons"></div>
    <div class="button-group-row">
      <button class="btn btn-danger btn-small" onclick="showView('mainMenu')" data-translate-key="buttons.mainMenu">â† Ana MenÃ¼</button>
    </div>
  </div>

  <div id="verbMenu" class="view">
    <h2 class="section-title" data-translate-key="titles.verbSelect">FÄ°Ä°L SEÃ‡</h2>
    <div id="verbButtons" class="button-grid"></div>
    <div class="button-group-row">
      <button class="btn btn-danger btn-small" onclick="showView('groupMenu')" data-translate-key="buttons.goBack">â† Geri</button>
    </div>
  </div>

  <div id="sectionMenu" class="view">
    <h2 class="section-title" data-translate-key="titles.sectionSelect">BÃ–LÃœM SEÃ‡</h2>
    <div id="sectionButtons" class="button-grid"></div>
    <div class="button-group-row">
      <button class="btn btn-danger btn-small" onclick="showView('verbMenu')" data-translate-key="buttons.goBack">â† Geri</button>
    </div>
  </div>

  <div id="modeMenu" class="view">
    <h2 class="large-centered-title" data-translate-key="titles.conversionSelect">Ã‡EVÄ°RÄ° YÃ–NÃœ</h2>
    <div class="content-box" style="margin-bottom: 20px;">
      <h4 data-translate-key="titles.conversionSelect">Ã‡eviri YÃ¶nÃ¼nÃ¼ SeÃ§in:</h4>
      <div class="button-group-row">
        <button class="btn conversion-btn btn-primary" id="modeTRDE" onclick="setConversionMode('tr-de'); startMode('study')">ğŸ‡¹ğŸ‡· TR â†’ DE ğŸ‡©ğŸ‡ª</button>
        <button class="btn conversion-btn btn-info" id="modeDETR" onclick="setConversionMode('de-tr'); startMode('study')">ğŸ‡©ğŸ‡ª DE â†’ TR ğŸ‡¹ğŸ‡·</button>
      </div>
    </div>
    <div class="button-group-row">
      <button class="btn btn-danger btn-small" onclick="showView('sectionMenu')" data-translate-key="buttons.goBack">â† Geri</button>
    </div>
  </div>

  <div id="learningView" class="view">
    <h2 class="section-title" id="learningTitle">...</h2>
    <div id="learningSubtitle" class="section-subtitle">...</div>
    
    <div class="progress-container">
      <div class="progress-bar"><div id="progressFill" class="progress-fill">0%</div></div>
      <div style="text-align:center;margin-top:8px;font-weight:700;"><span id="progressText">0 / 0</span></div>
    </div>
    <div class="content-box">
      <div id="learningContent"></div>
      <div id="hintPanel" class="hint-area" style="display:none"></div>
      <div id="resultArea"></div>
      <div id="answerArea"></div>
    </div>
    <div id="srsControls" class="button-group-row">
        <button class="btn btn-srs-zor" onclick="rateCard('zor')">ğŸ¥µ <span data-translate-key="srs.zor">ZOR</span></button>
        <button class="btn btn-srs-normal" onclick="rateCard('normal')">ğŸ¤” <span data-translate-key="srs.normal">NORMAL</span></button>
        <button class="btn btn-srs-ogrendim" onclick="rateCard('ogrendim')">âœ… <span data-translate-key="srs.ogrendim">Ã–ÄRENDÄ°M</span></button>
    </div>
    <div id="quickEditPanel" class="content-box" style="display:none; margin-top: 15px;">
        </div>
    <div class="primary-action-container">
      <button class="btn" id="actionBtn" data-translate-key="buttons.show" onclick="handleAction()">Kontrol Et / GÃ¶ster</button>
    </div>
    
    <div class="button-grid-learning">
      
      <button class="btn btn-category-toggle" id="btnToggleHint" onclick="toggleLearningSubPanel('Hint')">ğŸ’¡ Ä°pucu</button>
      <button class="btn btn-category-toggle" id="btnToggleListen" onclick="toggleLearningSubPanel('Listen')">ğŸ§ Dinle</button>
      <button class="btn btn-category-toggle" id="btnToggleEdit" onclick="toggleLearningSubPanel('Edit')">ğŸ”§ AraÃ§lar</button>
      
      <div class="sub-panel-grid" id="learningSubPanelHint">
        <button class="btn btn-ai" onclick="getAIHint()">ğŸ§  AI Ä°pucu Al</button>
        <button class="btn btn-info" onclick="showHintDetail('section')">BÃ¶lÃ¼m Ä°pucu</button>
        <button class="btn btn-info" onclick="showHintDetail('verb')">Fiil Ä°pucu</button>
        <button class="btn" id="toggleHintBtn" data-translate-key="buttons.hintToggle" onclick="toggleHintPanel()">CÃ¼mle Ä°pucu</button>
      </div>
      
      <div class="sub-panel-grid" id="learningSubPanelListen">
        <button class="btn" id="autoPlayBtn" onclick="toggleAutoPlay()">
          <span class="led-indicator" id="autoPlayLed"></span>Oto. Dinle
        </button>
        <button class="btn" id="slowModeToggleBtn" onclick="toggleSpeechSpeed()">
          <span class="led-indicator" id="slowModeLedL"></span>YavaÅŸ Mod
        </button>
        <button class="btn" id="pauseBtn" onclick="toggleSpeechPause()">â¸ï¸ Durdur</button>
        <button class="btn" id="btnPlayDE" data-translate-key="buttons.playDE" onclick="playCurrentSentence('de')">ğŸ”Š Almanca</button>
        <button class="btn" id="btnPlayTR" data-translate-key="buttons.playTR" onclick="playCurrentSentence('tr')">ğŸ”Š TÃ¼rkÃ§e</button>
      </div>

      <div class="sub-panel-grid" id="learningSubPanelEdit">
         <button class="btn" id="btnQuickEdit" onclick="showQuickEditPanel()">âœï¸ DÃ¼zelt/Ekle</button>
      </div>

      <button class="btn" onclick="previousQuestion()" data-translate-key="buttons.previous" style="margin-top: 10px;">â† Ã–nceki</button>
      <button class="btn btn-danger" id="learningExitBtn" onclick="showView('mainMenu')" data-translate-key="buttons.menuReturn">MenÃ¼ye DÃ¶n</button>
      
    </div>
    </div>

  <div id="hintDetailView" class="view">
    <div class="container">
        <h2 id="hintDetailTitle"></h2>
        <div id="hintDetailContent" class="hint-content-box" style="white-space: pre-wrap;"></div>
        <div class="button-group-row" style="justify-content:center;">
            <button class="btn btn-primary" onclick="showView('learningView')">â† Ã‡alÄ±ÅŸmaya Geri DÃ¶n</button>
        </div>
    </div>
  </div>

  <div id="storyView" class="view">
    <h2 class="section-title" data-translate-key="titles.story">Hikaye</h2>
    <div class="content-box" id="storyContent"></div>
    <div class="button-grid-learning">
      <button class="btn btn-warning" onclick="showStoryQuestions()" data-translate-key="buttons.questions">ğŸ“ Sorular</button>
      <button class="btn" id="storySlowModeToggleBtn" onclick="toggleSpeechSpeed()">
        <span class="led-indicator" id="slowModeLedS"></span>ğŸ”Š YavaÅŸ Mod
      </button>
      <button class="btn" id="storyPauseBtn" onclick="toggleSpeechPause()">â¸ï¸ Durdur</button>
      <button class="btn" id="btnPlayDE" data-translate-key="buttons.playDE" onclick="playStoryAudio('de')">ğŸ”Š Almanca Dinle</button>
      <button class="btn" onclick="playStoryAudio('tr')" data-translate-key="buttons.playTR">ğŸ”Š TÃ¼rkÃ§e Dinle</button>
      <button class="btn btn-danger" onclick="showView('groupMenu')" data-translate-key="buttons.groupMenuReturn">â† Grup MenÃ¼sÃ¼ne DÃ¶n</button>
    </div>
  </div>
  <div id="storyQuestionsView" class="view">
    <h2 class="section-title" data-translate-key="titles.storyQuestions">Hikaye SorularÄ±</h2>
    <div class="content-box" id="storyQuestionsContent"></div>
    <div class="button-group-row">
      <button class="btn btn-danger btn-small" onclick="showView('storyView')" data-translate-key="buttons.storyReturn">â† Hikayeye DÃ¶n</button>
    </div>
  </div>
  <div id="settings" class="view">
    <h2 class="section-title" data-translate-key="titles.settings">âš™ï¸ Ayarlar</h2>
    <div class="content-box">
      <h3 data-translate-key="settings.dataManagement">ğŸ’¾ Veri YÃ¶netimi</h3>
      <div class="button-grid" style="grid-template-columns: 1fr 1fr; margin-top: 10px;">
        <button class="btn btn-primary" style="width:100%;" onclick="importDataFromFile()" data-translate-key="buttons.importJSON">ğŸ“¥ Ä°Ã§erik YÃ¼kle (JSON)</button>
        <button class="btn btn-secondary" style="width:100%;" onclick="exportData()" data-translate-key="buttons.exportJSON">ğŸ“¤ Ä°Ã§erik Ä°ndir (JSON)</button>
      </div>
    </div>
    <div class="content-box">
      <h3 data-translate-key="settings.appearance">ğŸ¨ GÃ¶rÃ¼nÃ¼m ve DiÄŸer</h3>
      <div style="margin-top: 12px;">
          <label style="display:block;font-weight:700;margin-bottom:6px" data-translate-key="settings.language">Dil:</label>
          <div style="display:flex;gap:8px">
            <button class="lang-btn active" id="langTR" onclick="changeLanguage('tr', this)">TÃ¼rkÃ§e</button>
            <button class="lang-btn" id="langDE" onclick="changeLanguage('de', this)">Deutsch</button>
          </div>
      </div
      ><label style="display:flex;align-items:center;gap:8px;margin-top:15px;">
          <input type="checkbox" id="nightModeToggle" style="width: 20px; height: 20px;"> <span data-translate-key="settings.nightMode">Gece Modu</span>
      </label>
      <div style="margin-top: 15px;">
        <label style="display:block;font-weight:700;margin-bottom:6px" data-translate-key="settings.music">MÃ¼zik:</label>
        <div style="display:flex; align-items: center; gap: 10px;">
          <button id="settingsMusicToggle" class="btn btn-primary btn-small" onclick="musicPlayer.toggleMusic()">ğŸ”Š Ã‡al/Durdur</button>
          <input type="range" id="settingsMusicVolume" min="0" max="100" value="70" style="flex: 1;">
        </div>
      </div>
    </div>
    <div class="content-box">
        <h3 data-translate-key="settings.appUpdate">ğŸ”„ Uygulama</h3>
        <button class="btn btn-warning" style="width:100%; margin-top: 10px;" onclick="forceUpdateApp()" data-translate-key="buttons.forceUpdate">ğŸ”„ UygulamayÄ± GÃ¼ncelle</button>
    </div>
    <div class="content-box" style="margin-top:12px">
      <h3 data-translate-key="settings.pasteJSONTitle">ğŸ“ JSON YapÄ±ÅŸtÄ±r (Mobil)</h3>
      <textarea id="jsonPaste" class="textarea-field" data-translate-key="placeholders.jsonPaste" placeholder="JSON iÃ§eriÄŸinizi buraya yapÄ±ÅŸtÄ±rÄ±n..." rows="5"></textarea>
      <div class="button-group-row" style="margin-top:8px">
        <button class="btn btn-primary" onclick="loadJsonFromTextarea()" data-translate-key="buttons.pasteAndLoad">ğŸ“¥ YapÄ±ÅŸtÄ±r & YÃ¼kle</button>
        <button class="btn btn-danger" onclick="document.getElementById('jsonPaste').value=''" data-translate-key="buttons.clear">Temizle</button>
      </div>
    </div>
    <div class="button-group-row" style="margin-top:12px">
      <button class="btn btn-danger btn-small" onclick="showView('mainMenu')" data-translate-key="buttons.mainMenu">â† Ana MenÃ¼</button>
    </div>
  </div>
  <div id="progress" class="view">
    <h2 class="section-title" data-translate-key="titles.progress">ğŸ“Š Ä°lerleme</h2>
    <div class="content-box">
      <h3 data-translate-key="titles.srsStats">Tekrar Durumu</h3>
      <div class="progress-stats-grid">
        <div class="stat-card stat-card-zor">
          <h4 data-translate-key="srs.zorlandiklarim">ZORLANDIKLARIM</h4>
          <div class="stat-value" id="progressStatZor">0</div>
        </div>
        <div class="stat-card stat-card-normal">
          <h4 data-translate-key="srs.normal">NORMAL</h4>
          <div class="stat-value" id="progressStatNormal">0</div>
        </div>
        <div class="stat-card stat-card-ogrendim">
          <h4 data-translate-key="srs.ogrendiklerim">Ã–ÄRENDÄ°KLERÄ°M</h4>
          <div class="stat-value" id="progressStatOgrenildi">0</div>
        </div>
      </div>
    </div>
    <div class="content-box">
      <h3 data-translate-key="titles.totalProgress">Toplam Ã‡alÄ±ÅŸma Ä°lerlemesi</h3>
      <p class="small-muted" data-translate-key="messages.totalProgressDesc">TÃ¼m iÃ§erikteki (cÃ¼mlelerdeki) ilerleme durumunuz.</p>
      <div class="progress-container" style="margin-top: 15px;">
        <div class="progress-bar"><div id="totalProgressFill" class="progress-fill">0%</div></div>
        <div style="text-align:center;margin-top:8px;font-weight:700;"><span id="totalProgressText">0 / 0</span></div>
      </div>
    </div>
    <div class="content-box">
        <h3 data-translate-key="settings.progressManagement">ğŸ’¾ Ä°lerleme Veri YÃ¶netimi</h3>
        <div class="button-grid" style="grid-template-columns: 1fr 1fr; margin-top: 10px;">
           <button class="btn btn-primary" style="width:100%;" onclick="importSrsData()" data-translate-key="buttons.importProgress">ğŸ“¥ Ä°lerleme YÃ¼kle</button>
           <button class="btn btn-secondary" style="width:100%;" onclick="exportSrsData()" data-translate-key="buttons.exportProgress">ğŸ“¤ Ä°lerleme Ä°ndir</button>
        </div>
        <button class="btn btn-danger" style="width:100%; margin-top: 10px;" onclick="resetSrsData()" data-translate-key="buttons.resetSrs">âš ï¸ TÃ¼m Ä°lerlemeyi SÄ±fÄ±rla</button>
    </div>
    <div class="button-group-row">
      <button class="btn btn-danger btn-small" onclick="showView('mainMenu')" data-translate-key="buttons.mainMenu">â† Ana MenÃ¼</button>
    </div>
  </div>
  <div id="adminView" class="view">
    <h2 class="section-title" data-translate-key="titles.adminPanel">ğŸ”§ YÃ¶netici Paneli</h2>
    <div class="button-grid">
      <button class="btn btn-primary" onclick="showView('adminContentView')" data-translate-key="admin.contentManagement">ğŸ“š Ä°Ã§erik YÃ¶netimi</button>
      <button class="btn btn-warning" onclick="showGroupVerbImporter()">ğŸ—ï¸ Grup & Fiil YÃ¼kle</button>
      <button class="btn btn-info" onclick="showTsvImporter()">ğŸ“Š Toplu CÃ¼mle YÃ¼kle</button>
      <button class="btn btn-secondary" onclick="showView('adminSentenceListView')" data-translate-key="admin.listAllSentences">ğŸ“‹ TÃ¼m CÃ¼mleleri Listele</button>
    </div>
    <div id="adminGroupVerbArea" class="content-box" style="display:none; margin-top: 15px; border-color: #fbd38d;">
        <h4 data-translate-key="admin.groupVerbTitle">ğŸ—ï¸ Toplu Grup & Fiil YÃ¼kleme</h4>
        <p class="small-muted" data-translate-key="admin.groupVerbDesc">
          Excel'den kopyaladÄ±ÄŸÄ±nÄ±z YENÄ° GRUP ve FÄ°Ä°L listenizi buraya yapÄ±ÅŸtÄ±rÄ±n.<br>
          KullanmanÄ±z gereken sÃ¼tun sÄ±rasÄ± (Sekme/Tab ile ayrÄ±lmÄ±ÅŸ):<br>
          <b>GrupID | GrupAdÄ± | FiilID | FiilAdÄ± (TR) | FiilAdÄ± (DE)</b>
        </p>
        <textarea id="groupVerbPasteArea" class="textarea-field" rows="10" placeholder="g21 (Tab) PAKET TESLÄ°M SÃœRECÄ° (Tab) v61 (Tab) almak, toplamak (Tab) abholen..."></textarea>
        <div class="button-group-row">
            <button class="btn btn-warning" onclick="parseAndImportGroupsAndVerbs()">âœ… <span data-translate-key="buttons.pasteAndLoadTsv">YÃ¼kle ve Ä°ÅŸle</span></button>
            <button class="btn btn-danger" onclick="document.getElementById('adminGroupVerbArea').style.display='none'" data-translate-key="buttons.cancel">Ä°ptal</button>
        </div>
    </div>
    <div id="adminTsvArea" class="content-box" style="display:none; margin-top: 15px; border-color: #10b981;">
        <h4 data-translate-key="admin.tsvTitle">ğŸ“Š Toplu CÃ¼mle YÃ¼kleme (Excel'den Kopyala-YapÄ±ÅŸtÄ±r)</h4>
        <p class="small-muted" data-translate-key="admin.tsvDesc">
          Excel veya Google E-Tablolar'da hazÄ±rladÄ±ÄŸÄ±nÄ±z veriyi buraya yapÄ±ÅŸtÄ±rÄ±n.<br>
          KullanmanÄ±z gereken sÃ¼tun sÄ±rasÄ± (BAÅLIK SATIRI OLMADAN):<br>
          <b>GrupID | FiilID | BÃ¶lÃ¼mNumarasÄ± | TR_CÃ¼mle | DE_CÃ¼mle | CÃ¼mleIpucu (Ä°steÄŸe baÄŸlÄ±)</b>
        </p>
        <textarea id="tsvPasteArea" class="textarea-field" rows="10" placeholder="GrupID (Tab/VirgÃ¼l) FiilID (Tab/VirgÃ¼l) BÃ¶lÃ¼mNo (Tab/VirgÃ¼l) TR CÃ¼mle..."></textarea>
        <div class="button-group-row">
            <button class="btn btn-info" onclick="parseAndImportTsv()">âœ… <span data-translate-key="buttons.pasteAndLoadTsv">YÃ¼kle ve Ä°ÅŸle</span></button>
            <button class="btn btn-danger" onclick="document.getElementById('adminTsvArea').style.display='none'" data-translate-key="buttons.cancel">Ä°ptal</button>
        </div>
    </div>
    <div class="button-group-row" style="margin-top:12px">
      <button class="btn btn-danger btn-small" onclick="showView('mainMenu')" data-translate-key="buttons.mainMenu">â† Ana MenÃ¼</button>
    </div>
  </div>
  <div id="adminContentView" class="view">
     <h2 class="section-title" data-translate-key="admin.contentManagement">ğŸ“š Ä°Ã§erik YÃ¶netimi</h2>
     <div class="button-grid" style="grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));">
        <button class="btn btn-warning" onclick="showAdminForm('groupOrder')">â†•ï¸ SÄ±ralamayÄ± DÃ¼zenle (Gruplar)</button>  <button class="btn btn-primary" onclick="showAdminForm('addGroup')">â• <span data-translate-key="admin.addGroup">Grup Ekle/DÃ¼zenle</span></button>
        <button class="btn btn-primary" onclick="showAdminForm('addVerb')">â• <span data-translate-key="admin.addVerb">Fiil Ekle/DÃ¼zenle</span></button>
        <button class="btn btn-primary" onclick="showAdminForm('addSection')">â• <span data-translate-key="admin.addSection">BÃ¶lÃ¼m Ekle/DÃ¼zenle</span></button>
        <button class="btn btn-info" onclick="showAdminForm('addStory')">â• <span data-translate-key="admin.addStory">Hikaye Ekle/DÃ¼zenle</span></button>
        <button class="btn btn-info" onclick="showAdminForm('addHint')">ğŸ’¡ <span data-translate-key="admin.hintManagement">Ä°pucu Ekle/DÃ¼zenle</span></button>
        <button class="btn btn-secondary" onclick="showAdminForm('editSentence')">âœï¸ <span data-translate-key="admin.editSentence">CÃ¼mle Ekle/DÃ¼zenle</span></button>
     </div>
     <div id="adminContentArea" class="content-box" style="margin-top: 15px; display: none;">
     </div>
     <div class="button-group-row" style="margin-top:12px">
      <button class="btn btn-danger btn-small" onclick="showView('adminView')" data-translate-key="buttons.adminReturn">â† YÃ¶netici Paneline DÃ¶n</button>
    </div>
  </div>
  <div id="adminSentenceListView" class="view">
    <h2 class="section-title" data-translate-key="admin.listAllSentences">ğŸ“‹ TÃ¼m CÃ¼mleleri Listele</h2>
    <div class="content-box">
      <div class="button-group-row" style="margin-bottom:8px;">
        <button class="btn btn-secondary" onclick="renderAllSentencesTable()" data-translate-key="buttons.refreshList">ğŸ”„ Yenile Liste</button>
        <button class="btn btn-warning" onclick="exportSentencesCsv()" data-translate-key="buttons.exportCSV">ğŸ“¤ TSV Ä°ndir (Tablo)</button>
      </div>
      <div id="allSentencesTable" style="max-height:60vh;overflow:auto"></div>
    </div>
    <div class="button-group-row" style="margin-top:12px">
      <button class="btn btn-danger btn-small" onclick="showView('adminView')" data-translate-key="buttons.adminReturn">â† YÃ¶netici Paneline DÃ¶n</button>
    </div>
  </div>
</div>

<input type="file" id="fileInput" accept=".json" style="display:none">
<input type="file" id="progressFileInput" accept=".json" style="display:none">

<div id="toastNotification"></div>

<script>
/* ===============================
    Verb Matrix â€” v3.9
    - YENÄ° (v3.9): Ã–ÄŸrenme ekranÄ± baÅŸlÄ±ÄŸÄ± dinamik hale getirildi (Fiil AdÄ± / BÃ¶lÃ¼m AdÄ±).
    - YENÄ° (v3.9): 'BÃ¶lÃ¼m Bitti' ekranÄ± 'AkÄ±llÄ± Ä°lerleme'ye geÃ§irildi.
        - Ã–nce sonraki bÃ¶lÃ¼mÃ¼ arar.
        - Yoksa sonraki fiili arar.
        - Yoksa hikayeyi arar.
        - BitiÅŸ ekranÄ±ndaki 'MenÃ¼ye DÃ¶n' butonu (actionBtn) kaldÄ±rÄ±ldÄ±.
    - KORUNDU (v3.8): Ã–ÄŸrenme ekranÄ± 3'lÃ¼ kategori (Ä°pucu, Dinle, AraÃ§lar) ile sadeleÅŸtirildi.
    - KORUNDU (v3.8): SRS mantÄ±k hatasÄ± dÃ¼zeltildi. Kart statÃ¼sÃ¼ deÄŸiÅŸince desteden anÄ±nda Ã§Ä±karÄ±lÄ±yor.
    - KORUNDU (v3.8): Kart statÃ¼sÃ¼ deÄŸiÅŸince Toast (Bilgi MesajÄ±) gÃ¶steriliyor.
    - KORUNDU (v3.8): Ana MenÃ¼ ve Ã‡eviri YÃ¶nÃ¼ butonlarÄ± standart boyutta.
    =============================== */

/* ---------------- VarsayÄ±lan Veri --------------- */
let data = {
  groups: [ { id: "g1", name: "VarsayÄ±lan Grup", nameDE: "Standardgruppe" } ],
  verbs: { g1: [ { id:'v1', verbTR:'YÃ¼kleniyor...', verbDE:'Laden...' } ] },
  content: {},
  sections: { 1: "BÃ¶lÃ¼m 1" },
  sectionsHints: {},
  hints: { sentences: {}, verbs: {}, sections: {} },
  translations: {
    tr: {
      app: { subtitle: 'Fiiller Ä°le Almanca Ã–ÄŸrenme Platformu' },
      menu: { calis: 'ğŸ“š Ã‡alÄ±ÅŸ', tekrar: 'ğŸ”„ Tekrar', settings: 'âš™ï¸ Ayarlar', progress: 'ğŸ“Š Ä°lerleme', admin: 'ğŸ”§ YÃ¶netici' },
      titles: {
        start: 'BAÅLA', tekrar: 'ğŸ”„ TEKRAR', groupSelect: 'Fiil SeÃ§', storySelect: 'Hikaye SeÃ§', verbSelect: 'FÄ°Ä°L SEÃ‡', 
        sectionSelect: 'BÃ–LÃœM SEÃ‡', modeSelect: 'MODU SEÃ‡', conversionSelect: 'Ã‡EVÄ°RÄ° YÃ–NÃœ', learning: 'ğŸ“š Ã‡alÄ±ÅŸma ve Ä°pucu', 
        story: 'Hikaye', storyQuestions: 'Hikaye SorularÄ±', settings: 'âš™ï¸ Ayarlar', progress: 'ğŸ“Š Ä°lerleme', 
        adminPanel: 'ğŸ”§ YÃ¶netici Paneli', srsStats: 'Tekrar Durumu', totalProgress: 'Toplam Ã‡alÄ±ÅŸma Ä°lerlemesi'
      },
      buttons: {
        mainMenu: 'â† Ana MenÃ¼', goBack: 'â† Geri', show: 'GÃ¶ster', next: 'â†’ Sonraki', check: 'Kontrol Et', start: 'BaÅŸla',
        previous: 'â† Ã–nceki', menuReturn: 'MenÃ¼ye DÃ¶n', reset: 'BaÅŸa DÃ¶n', hintToggle: 'CÃ¼mle Ä°pucu',
        questions: 'ğŸ“ Sorular', playDE: 'ğŸ”Š Almanca', playTR: 'ğŸ”Š TÃ¼rkÃ§e',
        groupMenuReturn: 'â† Grup MenÃ¼sÃ¼ne DÃ¶n', storyReturn: 'â† Hikayeye DÃ¶n', adminReturn: 'â† YÃ¶netici Paneline DÃ¶n',
        importJSON: 'ğŸ“¥ Ä°Ã§erik YÃ¼kle (JSON)', exportJSON: 'ğŸ“¤ Ä°Ã§erik Ä°ndir (JSON)', importProgress: 'ğŸ“¥ Ä°lerleme YÃ¼kle', 
        exportProgress: 'ğŸ“¤ Ä°lerleme Ä°ndir', resetSrs: 'âš ï¸ TÃ¼m Ä°lerlemeyi SÄ±fÄ±rla', pasteAndLoad: 'ğŸ“¥ YapÄ±ÅŸtÄ±r & YÃ¼kle', 
        clear: 'Temizle', refreshList: 'ğŸ”„ Yenile Liste', exportCSV: 'ğŸ“¤ TSV Ä°ndir (Tablo)', save: 'Kaydet', 
        cancel: 'Ä°ptal', update: 'GÃ¼ncelle', add: 'Ekle', delete: 'Sil', edit: 'DÃ¼zenle', nextSection: 'â†’ Sonraki BÃ¶lÃ¼m',
        startStudy: 'ğŸ“– Ã‡alÄ±ÅŸmaya BaÅŸla', forceUpdate: 'ğŸ”„ UygulamayÄ± GÃ¼ncelle', pasteAndLoadTsv: 'YÃ¼kle ve Ä°ÅŸle'
      },
      settings: {
        appearance: 'ğŸ¨ GÃ¶rÃ¼nÃ¼m ve DiÄŸer', nightMode: 'Gece Modu', language: 'Dil:', music: 'MÃ¼zik:',
        dataManagement: 'ğŸ’¾ Ä°Ã§erik Veri YÃ¶netimi', progressManagement: 'ğŸ’¾ Ä°lerleme Veri YÃ¶netimi',
        appUpdate: 'ğŸ”„ Uygulama', pasteJSONTitle: 'ğŸ“ JSON YapÄ±ÅŸtÄ±r (Mobil)',
        pasteJSONDesc: 'Ä°Ã§erik JSON dosyanÄ±zÄ± buraya yapÄ±ÅŸtÄ±rÄ±n...'
      },
      admin: {
        contentManagement: 'ğŸ“š Ä°Ã§erik YÃ¶netimi', listAllSentences: 'ğŸ“‹ TÃ¼m CÃ¼mleleri Listele', 
        addGroup: 'Grup Ekle/DÃ¼zenle', addVerb: 'Fiil Ekle/DÃ¼zenle', addSection: 'BÃ¶lÃ¼m Ekle/DÃ¼zenle',
        editSentence: 'CÃ¼mle Ekle/DÃ¼zenle', addStory: 'Hikaye Ekle/DÃ¼zenle', hintManagement: 'Ä°pucu Ekle/DÃ¼zenle',
        groupVerbTitle: 'ğŸ—ï¸ Toplu Grup & Fiil YÃ¼kleme',
        groupVerbDesc: 'Excel\'den kopyaladÄ±ÄŸÄ±nÄ±z YENÄ° GRUP ve FÄ°Ä°L listenizi buraya yapÄ±ÅŸtÄ±rÄ±n.<br>KullanmanÄ±z gereken sÃ¼tun sÄ±rasÄ± (Sekme/Tab ile ayrÄ±lmÄ±ÅŸ):<br><b>GrupID | GrupAdÄ± | FiilID | FiilAdÄ± (TR) | FiilAdÄ± (DE)</b>',
        tsvTitle: 'ğŸ“Š Toplu CÃ¼mle YÃ¼kleme (Excel\'den Kopyala-YapÄ±ÅŸtÄ±r)',
        tsvDesc: 'Excel veya Google E-Tablolar\'da hazÄ±rladÄ±ÄŸÄ±nÄ±z veriyi buraya yapÄ±ÅŸtÄ±rÄ±n.<br>KullanmanÄ±z gereken sÃ¼tun sÄ±rasÄ± (BAÅLIK SATIRI OLMADAN):<br><b>GrupID | FiilID | BÃ¶lÃ¼mNumarasÄ± | TR_CÃ¼mle | DE_CÃ¼mle | CÃ¼mleIpucu (Ä°steÄŸe baÄŸlÄ±)</b>'
      },
      labels: {
        group: 'Grup:', verb: 'Fiil:', section: 'BÃ¶lÃ¼m:', sentence: 'CÃ¼mle:', index: 'Index:',
        hintText: 'Ä°pucu metni:', tr: 'TR:', de: 'DE:', title: 'BaÅŸlÄ±k:', deText: 'DE metin:', trText: 'TR metin:',
        groupID: 'Grup ID (Ã¶r: g5):', groupNameTR: 'Ad (TR):', groupNameDE: 'Ad (DE):',
        verbID: 'Fiil ID (Ã¶rn v10):', verbTR: 'Fiil TR:', verbDE: 'Fiil DE:',
        sectionCode: 'BÃ¶lÃ¼m Kodu (Ã¶rn: B1):', sectionNum: 'BÃ¶lÃ¼m NumarasÄ± (Ã¶rn: 1):', 
        sectionName: 'BÃ¶lÃ¼m AdÄ± (Ã¶rn: KiÅŸi Zamiri):', question: 'Soru:', 
        options: 'SeÃ§enekler (virgÃ¼lle ayÄ±r):', correctAnswer: 'DoÄŸru cevap (tam metin):'
      },
      placeholders: { jsonPaste: 'JSON iÃ§eriÄŸinizi buraya yapÄ±ÅŸtÄ±rÄ±n...', cloze: 'BoÅŸluÄŸu doldurun...', quiz: 'Ã‡eviriyi yazÄ±n...' },
      messages: {
        noGroups: 'HenÃ¼z grup yok. JSON yÃ¼kleyin.', noVerbs: 'Bu grupta fiil bulunamadÄ±.',
        noSentences: 'Bu fiil ve bÃ¶lÃ¼m iÃ§in cÃ¼mle bulunamadÄ±!', noDueCards: 'Bu kategoride tekrar edilecek kart kalmadÄ±! ğŸ‰',
        noNewCards: 'Bu bÃ¶lÃ¼mdeki tÃ¼m kartlarÄ± Ã§alÄ±ÅŸtÄ±nÄ±z! ğŸ‰', noStory: 'Bu grup iÃ§in hikaye bulunamadÄ±!',
        noStoryAvailable: 'Hikaye Yok', noStoryQuestions: 'Bu hikaye iÃ§in henÃ¼z soru yok.', noProgress: 'HenÃ¼z ilerleme yok.',
        noHints: 'Yok', noStoryFound: 'Hikaye bulunamadÄ±', ttsNotSupported: 'TarayÄ±cÄ± TTS desteklemiyor.',
        dataLoaded: 'âœ“ Ä°Ã§erik verisi yÃ¼klendi. Grup sayÄ±sÄ±:', progressLoaded: 'âœ“ Ä°lerleme verisi yÃ¼klendi.',
        invalidJSON: 'âœ— GeÃ§ersiz JSON formatÄ±.', loadError: 'âœ— Hata:', dataExported: 'âœ“ Ä°Ã§erik verisi (verbmatrix_data.json) indirildi!',
        progressExported: 'âœ“ Ä°lerleme verisi (verbmatrix_ilerleme_data.json) indirildi!',
        srsReset: 'âœ“ TÃ¼m Ã§alÄ±ÅŸma (SRS) verisi sÄ±fÄ±rlandÄ±.', jsonStatus: 'ğŸ“Š JSON DURUMU',
        allFieldsError: 'TÃ¼m alanlarÄ± doldurun', hintSaved: 'âœ… Ä°pucu kaydedildi',
        quickEditSaved: 'âœ… CÃ¼mle ve ipucu gÃ¼ncellendi (Yerel olarak kaydedildi)!',
        overrideReset: 'âœ… Ä°Ã§erik dÃ¼zeltmeleri silindi. Sayfa yenilendikten sonra varsayÄ±lan iÃ§eriÄŸe dÃ¶nÃ¼lecektir.',
        srsResetConfirm: 'TÃ¼m Ã§alÄ±ÅŸma (AralÄ±klÄ± Tekrar) verilerinizi sÄ±fÄ±rlamak istediÄŸinizden emin misiniz? TÃ¼m kartlarÄ±n ilerlemesi (Zor, Normal, Ã–ÄŸrendim) silinecektir.',
        totalProgressDesc: 'TÃ¼m iÃ§erikteki (cÃ¼mlelerdeki) ilerleme durumunuz.',
        // YENÄ° (v3.8) SRS Bildirim MesajlarÄ±
        cardMovedToNormal: 'Tebrikler! Kart "Normal" listesine taÅŸÄ±ndÄ±.',
        cardMovedToOgrenildi: 'Harika! Kart "Ã–ÄŸrendim" listesine taÅŸÄ±ndÄ±.',
        cardMovedToZor: 'Tekrar lazÄ±m. Kart "Zor" listesine taÅŸÄ±ndÄ±.',
        cardMovedToNormalFromOgrenildi: 'Dikkat! Kart "Normal" listesine dÃ¼ÅŸtÃ¼.'
      },
      srs: { zor: 'ğŸ¥µ ZOR', normal: 'ğŸ¤” NORMAL', ogrendim: 'âœ… Ã–ÄRENDÄ°M', zorlandiklarim: 'ZORLANDIKLARIM', ogrendiklerim: 'Ã–ÄRENDÄ°KLERÄ°M' },
      modes: { cloze: 'BoÅŸluk Doldurma', wordorder: 'Kelimeleri SÄ±ralama', quiz: 'Quiz (Test)', study: 'Ã‡alÄ±ÅŸma (Yeni Kartlar)' }
    },
    de: { /* ... Almanca Ã§eviriler ... */ }
  },
  settings:{ language:'tr', nightMode:false, conversionMode: 'tr-de' }
};

let srsData = {};
let contentOverride = {};

/* ---------------- State ---------------- */
let state = {
  currentView:'mainMenu',
  group:null, groupData:null,
  verb:null, section:null,
  mode:null,
  tekrarStatus: null,
  deck: [],
  deckPos: 0,
  currentCardKey: null,
  currentCardData: null,
  showAnswer:false,
  wordPool:[], wordSelected:[], userAnswer:'', correctAnswer:'', showResult:false,
  hintPanelVisible: false,
  speechRate: 1.0,
  isSpeaking: false,
  autoPlayAudio: true,
  activeLearningPanel: null // v3.8
};

/* ---------- MÃ¼zik Ã‡alar ---------- */
class MusicPlayer {
  constructor(streamUrl, volumeSliderId, toggleBtnId, settingsSliderId, settingsToggleId) {
    this.audio = new Audio(streamUrl);
    this.audio.crossOrigin = "anonymous";
    this.audio.loop = true;
    this.isPlaying = false;
    this.currentVolume = 0.7;
    this.dimmedVolume = 0.2;
    this.isDimmed = false;
    this.slider = document.getElementById(volumeSliderId);
    this.toggleBtn = document.getElementById(toggleBtnId);
    this.settingsSlider = document.getElementById(settingsSliderId);
    this.settingsToggleBtn = document.getElementById(settingsToggleId);
    const savedVolume = parseFloat(localStorage.getItem('verbmatrix_music_volume')) || 0.7;
    this.setVolume(savedVolume * 100, true);
    if (this.toggleBtn) this.toggleBtn.addEventListener('click', () => this.toggleMusic());
    if (this.slider) this.slider.addEventListener('input', (e) => this.setVolume(e.target.value));
    if (this.settingsToggleBtn) this.settingsToggleBtn.addEventListener('click', () => this.toggleMusic());
    if (this.settingsSlider) this.settingsSlider.addEventListener('input', (e) => this.setVolume(e.target.value));
  }
  updateUI() {
      const t = getMergedTranslations(data.settings.language || 'tr');
      const isPlaying = this.isPlaying;
      if (this.toggleBtn) this.toggleBtn.textContent = isPlaying ? 'â¸ï¸' : 'ğŸ”Š';
      if (this.settingsToggleBtn) {
          this.settingsToggleBtn.textContent = isPlaying ? 'â¸ï¸ ' + (t.buttons.pause || 'Durdur') : 'ğŸ”Š ' + (t.buttons.play || 'Ã‡al');
      }
      const volumeValue = this.currentVolume * 100;
      if (this.slider) this.slider.value = volumeValue;
      if (this.settingsSlider) this.settingsSlider.value = volumeValue;
  }
  toggleMusic() {
    if (this.isPlaying) {
      this.audio.pause();
      this.isPlaying = false;
    } else {
      this.audio.load();
      this.audio.play().then(() => {
        this.isPlaying = true;
      }).catch(error => {
        console.error("MÃ¼zik Ã§alÄ±namadÄ±:", error);
      });
    }
    this.updateUI();
  }
  setVolume(volumeValue, isInit = false) {
    const newVolume = parseFloat(volumeValue) / 100;
    this.currentVolume = newVolume;
    if (!this.isDimmed) {
      this.audio.volume = this.currentVolume;
    }
    if (!isInit) {
        try { localStorage.setItem('verbmatrix_music_volume', this.currentVolume.toString()); } catch (e) {}
    }
    if (this.slider) this.slider.value = volumeValue;
    if (this.settingsSlider) this.settingsSlider.value = volumeValue;
  }
  dim_music(dim) {
    if (!this.isPlaying) return;
    if (dim) {
      this.isDimmed = true;
      this.audio.volume = this.dimmedVolume;
    } else {
      this.isDimmed = false;
      this.audio.volume = this.currentVolume;
    }
  }
}
let musicPlayer = null;

/* ---------- KonuÅŸma Sentezi ---------- */
let speechUtterance = null;
function toggleAutoPlay() {
  state.autoPlayAudio = !state.autoPlayAudio;
  const btn = document.getElementById('autoPlayBtn');
  const led = document.getElementById('autoPlayLed');
  if (btn) {
    if (state.autoPlayAudio) {
      btn.innerHTML = `<span class="led-indicator active" id="autoPlayLed"></span>Oto. Aktif`;
      led.classList.add('active');
    } else {
      btn.innerHTML = `<span class="led-indicator" id="autoPlayLed"></span>Oto. Dinle`;
      led.classList.remove('active');
    }
  }
}
function updateSpeedButtonUI() {
    const ledL = document.getElementById('slowModeLedL');
    const ledS = document.getElementById('slowModeLedS');
    if (state.speechRate === 0.5) {
        if(ledL) ledL.classList.add('active');
        if(ledS) ledS.classList.add('active');
    } else {
        if(ledL) ledL.classList.remove('active');
        if(ledS) ledS.classList.remove('active');
    }
}
function toggleSpeechSpeed() {
    state.speechRate = (state.speechRate === 1.0) ? 0.5 : 1.0;
    updateSpeedButtonUI();
    if (speechUtterance && !speechSynthesis.paused) {
        speechSynthesis.cancel();
        speechSynthesis.speak(speechUtterance);
    }
}
function toggleSpeechPause() {
    if ('speechSynthesis' in window) {
        const btnL = document.getElementById('pauseBtn');
        const btnS = document.getElementById('storyPauseBtn');
        const btn = btnL && btnL.offsetParent !== null ? btnL : btnS;
        if (!btn) return;
        if (speechSynthesis.paused) {
            speechSynthesis.resume();
            btn.textContent = 'â¸ï¸ Durdur';
        } else {
            speechSynthesis.pause();
            btn.textContent = 'â–¶ï¸ Oynat';
        }
    }
}
function resetSpeechButtons() {
    if ('speechSynthesis' in window) {
        window.speechSynthesis.cancel();
    }
    const pauseBtnL = document.getElementById('pauseBtn');
    const pauseBtnS = document.getElementById('storyPauseBtn');
    if (pauseBtnL) { pauseBtnL.textContent = 'â¸ï¸ Durdur'; }
    if (pauseBtnS) { pauseBtnS.textContent = 'â¸ï¸ Durdur'; }
}

/* ---------- YENÄ° (v3.8): Toast (Bilgi MesajÄ±) Sistemi ---------- */
let toastTimer;
function showToast(message, type = 'success') {
    const toast = document.getElementById('toastNotification');
    if (!toast) return;

    clearTimeout(toastTimer); // Ã–nceki zamanlayÄ±cÄ±yÄ± temizle
    toast.className = ''; // Ã–nceki sÄ±nÄ±flarÄ± temizle

    toast.textContent = message;
    toast.classList.add('show'); 

    if (type === 'success') {
        toast.classList.add('success');
    } else if (type === 'error') {
        toast.classList.add('error');
    }

    toastTimer = setTimeout(() => {
        toast.className = toast.className.replace('show', '');
    }, 3000);
}

/* ---------- SRS (Ä°lerleme) Veri YÃ¶netimi ---------- */
function getSrsKey(verbId, sectionNum, sentenceIndex) {
    return `${verbId}_s${sectionNum}_${sentenceIndex}`;
}
function loadSrsData() {
    try {
        const data = localStorage.getItem('verbmatrix_srs_data_v3');
        srsData = data ? JSON.parse(data) : {};
    } catch (e) {
        console.error("SRS verisi yÃ¼klenemedi", e);
        srsData = {};
    }
    updateProgressView();
}
function saveSrsData() {
    try {
        localStorage.setItem('verbmatrix_srs_data_v3', JSON.stringify(srsData));
    } catch (e) {
        console.error("SRS verisi kaydedilemedi", e);
    }
    updateProgressView();
}
function getCardSrsData(key) {
    if (!srsData[key]) {
        srsData[key] = {
            status: 'new',
            quizHistory: []
        };
    }
    return srsData[key];
}
function exportSrsData() { /* ... deÄŸiÅŸiklik yok ... */ }
function importSrsData() { /* ... deÄŸiÅŸiklik yok ... */ }
function rateCard(newStatus) {
    const cardData = getCardSrsData(state.currentCardKey);
    cardData.status = newStatus;
    cardData.quizHistory = [];
    console.log(`Kart ${state.currentCardKey} -> ${newStatus} olarak ayarlandÄ±.`);
    saveSrsData();
    state.deckPos++;
    state.showAnswer = false;
    showLearning();
}

/**
 * GÃœNCELLENDÄ° (v3.8): SRS MantÄ±k DÃ¼zeltmesi
 * KartÄ±n statÃ¼sÃ¼nÃ¼ gÃ¼nceller ve statÃ¼ deÄŸiÅŸip deÄŸiÅŸmediÄŸini dÃ¶ner.
 * @returns {string|null} - EÄŸer statÃ¼ deÄŸiÅŸtiyse YENÄ° statÃ¼yÃ¼ dÃ¶ner, deÄŸiÅŸmediyse null dÃ¶ner.
 */
function updateSrsStatusAfterQuiz(key, isCorrect) {
    const t = getMergedTranslations(data.settings.language || 'tr');
    const cardData = getCardSrsData(key);
    const history = cardData.quizHistory || [];
    history.push(isCorrect ? 1 : 0);
    while (history.length > 5) {
        history.shift();
    }
    cardData.quizHistory = history;
    const oldStatus = cardData.status;

    let toastMessage = null;
    let toastType = 'success';

    if (oldStatus === 'zor' && history.length >= 2 && history.slice(-2).every(v => v === 1)) {
        cardData.status = 'normal';
        cardData.quizHistory = [];
        toastMessage = t.messages.cardMovedToNormal;
    }
    else if (oldStatus === 'normal' && history.length >= 3 && history.slice(-3).every(v => v === 1)) {
        cardData.status = 'ogrendim';
        cardData.quizHistory = [];
        toastMessage = t.messages.cardMovedToOgrenildi;
    }
    else if (oldStatus === 'normal' && history.length >= 3 && history.slice(-3).every(v => v === 0)) {
        cardData.status = 'zor';
        cardData.quizHistory = [];
        toastMessage = t.messages.cardMovedToZor;
        toastType = 'error';
    }
    else if (oldStatus === 'ogrendim' && history.length >= 2 && history.slice(-2).every(v => v === 0)) {
        cardData.status = 'normal';
        cardData.quizHistory = [];
        toastMessage = t.messages.cardMovedToNormalFromOgrenildi;
        toastType = 'error';
    }
    
    const newStatus = cardData.status;
    saveSrsData();

    if (newStatus !== oldStatus) {
        showToast(toastMessage, toastType);
        return newStatus; // StatÃ¼ deÄŸiÅŸti, yeni statÃ¼yÃ¼ dÃ¶n
    }
    return null; // StatÃ¼ deÄŸiÅŸmedi
}

function resetSrsData() { /* ... deÄŸiÅŸiklik yok ... */ }

/* ---------- Ä°Ã§erik (Content) Veri YÃ¶netimi ---------- */
async function loadDataFromServer() { /* ... deÄŸiÅŸiklik yok ... */ }
function loadContentOverride() { /* ... deÄŸiÅŸiklik yok ... */ }
function saveContentOverride() { /* ... deÄŸiÅŸiklik yok ... */ }
function exportData(){ /* ... deÄŸiÅŸiklik yok ... */ }
function importData(imported){ /* ... deÄŸiÅŸiklik yok ... */ }
function importDataFromFile(){ /* ... deÄŸiÅŸiklik yok ... */ }
function loadJsonFromTextarea(){ /* ... deÄŸiÅŸiklik yok ... */ }

/* ---------- Ayarlar ve ArayÃ¼z FonksiyonlarÄ± ---------- */
function showView(id){
  document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
  const el = document.getElementById(id);
  if(el) el.classList.add('active');
  state.currentView = id;
  const headerEl = document.querySelector('.container > header');
  const hideLogo = ['learningView', 'storyView', 'storyQuestionsView', 'hintDetailView'].includes(id);
  if (headerEl) {
      headerEl.style.display = hideLogo ? 'none' : 'block';
  }
  resetSpeechButtons();
  if (id === 'learningView' || id === 'storyView') {
      updateSpeedButtonUI();
  }
  
  // YENÄ° (v3.8): Ã–ÄŸrenme ekranÄ±ndan Ã§Ä±karken panelleri gizle
  if (id !== 'learningView') {
      document.querySelectorAll('.sub-panel-grid').forEach(p => p.classList.remove('active'));
      state.activeLearningPanel = null;
  }

  const homeBtn = document.getElementById('floatingHomeBtn');
  if (homeBtn) {
    homeBtn.style.display = (id === 'mainMenu') ? 'none' : 'block';
  }
  const adminBtn = document.getElementById('floatingAdminBtn');
  if (adminBtn) {
    adminBtn.style.display = (id === 'mainMenu') ? 'block' : 'none';
  }

  if(id === 'modeMenu' || id === 'tekrarModeMenu') {
      updateConversionButtons();
  }
  if(id === 'adminView'){ /* ... deÄŸiÅŸiklik yok ... */ }
  if(id === 'adminContentView'){ /* ... deÄŸiÅŸiklik yok ... */ }
  if(id === 'adminSentenceListView'){ /* ... deÄŸiÅŸiklik yok ... */ }
  if(id === 'progress') { updateProgressView(); }
  if(id === 'tekrarMenu') { updateProgressView(); }
}

/* ---------- YENÄ° (v3.8): Ã–ÄŸrenme EkranÄ± Alt Panel KontrolÃ¼ ---------- */
function toggleLearningSubPanel(panelName) {
    const panelId = 'learningSubPanel' + panelName;
    const targetPanel = document.getElementById(panelId);
    if (!targetPanel) return;
    if (state.activeLearningPanel === panelName) {
        targetPanel.classList.remove('active');
        state.activeLearningPanel = null;
    } else {
        document.querySelectorAll('.sub-panel-grid').forEach(p => p.classList.remove('active'));
        targetPanel.classList.add('active');
        state.activeLearningPanel = panelName;
    }
}

function getProperty(obj, keyString) { /* ... deÄŸiÅŸiklik yok ... */ }
function getMergedTranslations(lang = 'tr') { /* ... deÄŸiÅŸiklik yok ... */ }
function updateUITexts(){ /* ... deÄŸiÅŸiklik yok ... */ }
function updateAutoPlayButtonText() {
    const autoPlayBtn = document.getElementById('autoPlayBtn');
    if (autoPlayBtn) {
        if (state.autoPlayAudio) {
            autoPlayBtn.innerHTML = `<span class="led-indicator active" id="autoPlayLed"></span>Oto. Aktif`;
        } else {
            autoPlayBtn.innerHTML = `<span class="led-indicator" id="autoPlayLed"></span>Oto. Dinle`;
        }
    }
}
function changeLanguage(lang, btnEl){ /* ... deÄŸiÅŸiklik yok ... */ }
function toggleNightMode(){ /* ... deÄŸiÅŸiklik yok ... */ }
function saveSettings(){ /* ... deÄŸiÅŸiklik yok ... */ }
function loadSettings(){ /* ... deÄŸiÅŸiklik yok ... */ }

/* ---------- Ã‡eviri YÃ¶nÃ¼ (Conversion Mode) ---------- */
function setConversionMode(mode) {
    data.settings.conversionMode = mode;
    saveSettings();
    updateConversionButtons();
}
function updateConversionButtons() {
    const modes = ['mode', 'tekrarMode'];
    const activeMode = data.settings.conversionMode; 
    modes.forEach(prefix => {
        const trdeBtn = document.getElementById(prefix + 'TRDE');
        const detrBtn = document.getElementById(prefix + 'DETR');
        if (!trdeBtn || !detrBtn) return;
        if (activeMode === 'tr-de') {
            trdeBtn.classList.add('btn-primary'); trdeBtn.classList.remove('btn-info');
            detrBtn.classList.add('btn-info'); detrBtn.classList.remove('btn-primary');
        } else {
            trdeBtn.classList.add('btn-info'); trdeBtn.classList.remove('btn-primary');
            detrBtn.classList.add('btn-primary'); detrBtn.classList.remove('btn-info');
        }
        if (prefix === 'tekrarMode') {
            const trdeLed = trdeBtn.querySelector('.led-indicator');
            const detrLed = detrBtn.querySelector('.led-indicator');
            if (trdeLed && detrLed) {
                if (activeMode === 'tr-de') {
                    trdeLed.classList.add('active'); detrLed.classList.remove('active');
                } else {
                    trdeLed.classList.remove('active'); detrLed.classList.add('active');
                }
            }
        }
    });
}

/* ---------- AI Ä°pucu Entegrasyonu (v3.7) ---------- */
async function getAIHint() { /* ... deÄŸiÅŸiklik yok ... */ }

/* ---------- ANA AKIÅ FONKSÄ°YONLARI ---------- */
function loadAndShowGroupMenu(){ /* ... deÄŸiÅŸiklik yok ... */ }
function selectGroup(id){ /* ... deÄŸiÅŸiklik yok ... */ }
function selectVerb(verbId){ /* ... deÄŸiÅŸiklik yok ... */ }
function selectSection(sectionNum){
  state.section = sectionNum;
  showView('modeMenu');
}

/* ---------- AkÄ±ÅŸ 2: Tekrar ---------- */
function startTekrar(status) { /* ... deÄŸiÅŸiklik yok ... */ }
function startTekrarModePrompt() { /* ... deÄŸiÅŸiklik yok ... */ }
function startTekrarMode(modeId) { /* ... deÄŸiÅŸiklik yok ... */ }

/* ---------- AkÄ±ÅŸ 3: Ã‡alÄ±ÅŸma EkranÄ± (Learning View) ---------- */
function startMode(modeId){ /* ... deÄŸiÅŸiklik yok ... */ }
function getSentences(){ /* ... deÄŸiÅŸiklik yok ... */ }
function shuffle(a){ /* ... deÄŸiÅŸiklik yok ... */ }

/**
 * YENÄ° (v3.9): Ã‡alÄ±ÅŸma ekranÄ± baÅŸlÄ±ÄŸÄ±nÄ± gÃ¼nceller.
 */
function updateLearningTitle() {
    const t = getMergedTranslations(data.settings.language || 'tr');
    const titleEl = document.getElementById('learningTitle');
    const subtitleEl = document.getElementById('learningSubtitle');
    
    if (!state.verb || !state.section || !titleEl || !subtitleEl) {
        if (titleEl) titleEl.textContent = t.titles.learning;
        if (subtitleEl) subtitleEl.textContent = '';
        return;
    }
    
    const verbData = (data.verbs[state.group] || []).find(v => v.id === state.verb);
    const verbName = verbData ? (verbData.verbDE || verbData.verbTR) : state.verb;
    const sectionName = data.sections[state.section] || `BÃ¶lÃ¼m ${state.section}`;
    const modeName = t.modes[state.mode] || '';

    titleEl.textContent = `Fiil: "${verbName}"`;
    subtitleEl.textContent = `${sectionName} - (${modeName})`;
}

function showLearning(){
  const t = getMergedTranslations(data.settings.language || 'tr');
  resetSpeechButtons();
  
  // YENÄ° (v3.8): Her yeni kartta alt panelleri kapat
  document.querySelectorAll('.sub-panel-grid').forEach(p => p.classList.remove('active'));
  state.activeLearningPanel = null;
  
  const exitBtn = document.getElementById('learningExitBtn');
  if (state.mode === 'study') {
      exitBtn.onclick = () => showView('sectionMenu'); // Geri BÃ¶lÃ¼m seÃ§imine gitsin
  } else {
      exitBtn.onclick = () => showView('tekrarModeMenu');
  }
  
  // YENÄ° (v3.9): BaÅŸlÄ±ÄŸÄ± gÃ¼ncelle
  updateLearningTitle();
  
  if (state.deck.length === 0) {
      /* ... deÄŸiÅŸiklik yok ... */
  }
  if (state.deckPos >= state.deck.length) {
      showCompletion();
      return;
  }
  state.currentCardKey = state.deck[state.deckPos];
  const parts = state.currentCardKey.match(/^(.*?)_s(\d+)_(\d+)$/);
  if (!parts) { /* ... deÄŸiÅŸiklik yok ... */ }
  const verbId = parts[1];
  const sectionNum = parts[2];
  const sentenceIndex = parseInt(parts[3]);
  const sentenceArray = data.content[`${verbId}_s${sectionNum}`] || [];
  state.currentCardData = sentenceArray[sentenceIndex];
  if (!state.currentCardData) { /* ... deÄŸiÅŸiklik yok ... */ }
  renderSentence();
  showView('learningView');
}
function updateProgress(current, total){ /* ... deÄŸiÅŸiklik yok ... */ }
function buildSentenceHintHtml(){ /* ... deÄŸiÅŸiklik yok ... */ }
function showHintDetail(type) { /* ... deÄŸiÅŸiklik yok ... */ }
function renderSentence(){
  const container = document.getElementById('learningContent');
  document.getElementById('resultArea').innerHTML='';
  document.getElementById('answerArea').innerHTML='';
  const hintPanelEl = document.getElementById('hintPanel');
  const quickEditPanel = document.getElementById('quickEditPanel');
  quickEditPanel.style.display = 'none';
  hintPanelEl.style.display = state.hintPanelVisible ? 'block' : 'none';
  hintPanelEl.innerHTML = '';
  state.showResult = false;
  state.wordPool = [];
  state.wordSelected = [];
  
  // YENÄ° (v3.9): BaÅŸlÄ±ÄŸÄ± gÃ¼ncelle
  updateLearningTitle();
  
  if (state.deckPos >= state.deck.length) {
      showCompletion();
      return;
  }
  const sent = state.currentCardData;
  if (!sent) { return; }
  container.innerHTML = '';
  const hintHtml = buildSentenceHintHtml();
  const t = getMergedTranslations(data.settings.language || 'tr');
  const isTrDe = data.settings.conversionMode === 'tr-de';
  const questionText = isTrDe ? sent.tr : sent.de;
  const answerText = isTrDe ? sent.de : sent.tr;
  const questionLang = isTrDe ? 'TR' : 'DE';
  const answerLang = isTrDe ? 'DE' : 'TR';

  // BaÅŸlÄ±k ayarÄ± 'updateLearningTitle' fonksiyonuna taÅŸÄ±ndÄ± (v3.9)

  if(state.mode === 'study'){ /* ... deÄŸiÅŸiklik yok ... */ } 
  else if(state.mode === 'cloze'){ /* ... deÄŸiÅŸiklik yok ... */ } 
  else if(state.mode === 'wordorder'){ /* ... deÄŸiÅŸiklik yok ... */ } 
  else if(state.mode === 'quiz'){ /* ... deÄŸiÅŸiklik yok ... */ }
  
  if(state.hintPanelVisible){
    hintPanelEl.innerHTML = hintHtml;
    hintPanelEl.style.display = 'block';
  } else {
    hintPanelEl.innerHTML = '';
    hintPanelEl.style.display = 'none';
  }
  
  // GÃœNCELLEME (v3.8): Dinle butonlarÄ± panelde
  const btnDE = document.getElementById('btnPlayDE');
  const btnTR = document.getElementById('btnPlayTR');
  if (btnDE && btnTR) {
      const canPlayDE = (state.mode === 'study' && state.showAnswer) || state.showResult || !isTrDe;
      const canPlayTR = (state.mode === 'study' && state.showAnswer) || state.showResult || isTrDe;
      btnDE.disabled = !canPlayDE; btnDE.classList.toggle('disabled', !canPlayDE);
      btnTR.disabled = !canPlayTR; btnTR.classList.toggle('disabled', !canPlayTR);
  }
  
  const actionBtn = document.getElementById('actionBtn');
  const srsControls = document.getElementById('srsControls');
  
  if (state.mode === 'study') {
      actionBtn.classList.add('btn-show'); // v3.8 stili
      if (state.showAnswer) {
          actionBtn.style.display = 'none';
          srsControls.style.display = 'flex';
      } else {
          actionBtn.style.display = 'block';
          srsControls.style.display = 'none';
          actionBtn.textContent = t.buttons.show;
          actionBtn.onclick = handleAction;
      }
      document.querySelector('[onclick="previousQuestion()"]').style.display = 'none';
  } else {
      actionBtn.classList.remove('btn-show'); // v3.8 stili
      actionBtn.style.display = 'block';
      srsControls.style.display = 'none';
      actionBtn.textContent = t.buttons.check;
      actionBtn.onclick = handleAction;
      document.querySelector('[onclick="previousQuestion()"]').style.display = 'block';
  }
  updateProgress(state.deckPos, state.deck.length);
}
function showQuickEditPanel(){ /* ... deÄŸiÅŸiklik yok ... */ }
function saveQuickEdit(){ /* ... deÄŸiÅŸiklik yok ... */ }
function renderWordOrder(){ /* ... deÄŸiÅŸiklik yok ... */ }
function selectWordFromPool(index){ /* ... deÄŸiÅŸiklik yok ... */ }
function unselectWord(index, word){ /* ... deÄŸiÅŸiklik yok ... */ }

/**
 * GÃœNCELLENDÄ° (v3.8): SRS MantÄ±k DÃ¼zeltmesi
 */
function handleAction(){
  const btn = document.getElementById('actionBtn');
  const resultArea = document.getElementById('resultArea'), answerArea = document.getElementById('answerArea');
  const t = getMergedTranslations(data.settings.language || 'tr');
  const triggerAutoPlay = () => {
      if (state.autoPlayAudio) {
          playCurrentSentence('de');
      }
  };
  
  if(state.mode === 'study'){
    if(!state.showAnswer){
      const ad = document.getElementById('answerDisplay');
      if(ad) ad.classList.remove('hidden');
      state.showAnswer = true;
      btn.style.display = 'none';
      document.getElementById('srsControls').style.display = 'flex';
      renderSentence(); // Dinle butonlarÄ±nÄ± aktif etmek iÃ§in
      triggerAutoPlay();
    }
  } else {
    if(state.showResult){
        state.deckPos++; // Bir sonraki karta geÃ§
        state.showAnswer=false;
        state.showResult=false;
        showLearning();
        return;
    }
    let userAnswer = '';
    let isCorrect = false;
    if (state.mode === 'cloze') { /* ... */ } 
    else if (state.mode === 'wordorder') { /* ... */ } 
    else if (state.mode === 'quiz') { /* ... */ }
    
    resultArea.innerHTML = isCorrect ? '<div class="result correct">âœ“ DoÄŸru!</div>' : '<div class="result incorrect">âœ— YanlÄ±ÅŸ!</div>';
    answerArea.innerHTML = `<div class="result"><strong>Sizin:</strong> ${escapeHtml(userAnswer||'(boÅŸ)')}</div><div class="result"><strong>DoÄŸru:</strong> ${escapeHtml(state.correctAnswer)}</div>`;
    
    // YENÄ° (v3.8): StatÃ¼ deÄŸiÅŸimini kontrol et
    const newStatus = updateSrsStatusAfterQuiz(state.currentCardKey, isCorrect);
    
    if (newStatus) {
        // StatÃ¼ deÄŸiÅŸti! KartÄ± mevcut quiz destesinden Ã§Ä±kar.
        state.deck.splice(state.deckPos, 1);
        state.deckPos--; // Deste kÃ¼Ã§Ã¼ldÃ¼ÄŸÃ¼ iÃ§in indeksi geri Ã§ek
    }
    
    state.showResult=true;
    btn.textContent = t.buttons.next;
    renderSentence(); // Dinle butonlarÄ±nÄ± aktif etmek iÃ§in
    triggerAutoPlay();
  }
}
function previousQuestion(){ /* ... deÄŸiÅŸiklik yok ... */ }

/* ---------- YENÄ° (v3.9): AkÄ±llÄ± Ä°lerleme YardÄ±mcÄ± FonksiyonlarÄ± ---------- */

// O anki fiil iÃ§in bir sonraki Ã§alÄ±ÅŸÄ±labilir bÃ¶lÃ¼mÃ¼ bulur
function findNextStudySection(verbId, currentSectionNum) {
    const sectionKeys = Object.keys(data.sections).map(Number).sort((a, b) => a - b);
    const currentSectionIndex = sectionKeys.indexOf(currentSectionNum);
    
    if (currentSectionIndex === -1) return null;

    for (let i = currentSectionIndex + 1; i < sectionKeys.length; i++) {
        const nextSecNum = sectionKeys[i];
        const contentKey = `${verbId}_s${nextSecNum}`;
        // O bÃ¶lÃ¼mde iÃ§erik var mÄ±?
        if (data.content[contentKey] && data.content[contentKey].length > 0) {
            // O bÃ¶lÃ¼mdeki kartlar 'new' mi?
            for (let j = 0; j < data.content[contentKey].length; j++) {
                const srsKey = getSrsKey(verbId, nextSecNum, j);
                if (getCardSrsData(srsKey).status === 'new') {
                    return nextSecNum; // Ã‡alÄ±ÅŸÄ±labilir bÃ¶lÃ¼m bulundu
                }
            }
        }
    }
    return null; // BaÅŸka Ã§alÄ±ÅŸÄ±labilir bÃ¶lÃ¼m yok
}

// O anki grup iÃ§in bir sonraki Ã§alÄ±ÅŸÄ±labilir fiili bulur
function findNextStudyVerb(groupId, currentVerbId) {
    const verbList = data.verbs[groupId] || [];
    const currentVerbIndex = verbList.findIndex(v => v.id === currentVerbId);

    if (currentVerbIndex === -1) return null;

    for (let i = currentVerbIndex + 1; i < verbList.length; i++) {
        const nextVerb = verbList[i];
        // Bu fiilin Ã§alÄ±ÅŸÄ±labilir *herhangi bir* bÃ¶lÃ¼mÃ¼ var mÄ±?
        const firstAvailableSection = findNextStudySection(nextVerb.id, -1); // -1 ile en baÅŸtan ara
        if (firstAvailableSection) {
            return nextVerb; // Ã‡alÄ±ÅŸÄ±labilir fiil bulundu
        }
    }
    return null; // BaÅŸka Ã§alÄ±ÅŸÄ±labilir fiil yok
}

// Bir sonraki bÃ¶lÃ¼me atlar
function goToNextSection(sectionNum) {
    selectSection(sectionNum); // Bu modeMenu'yÃ¼ aÃ§ar
    startMode('study'); // Bu da learningView'Ã¼ baÅŸlatÄ±r
}

// Bir sonraki fiile atlar
function goToNextVerb(verbId) {
    // Fiili seÃ§
    selectVerb(verbId); 
    // O fiilin ilk Ã§alÄ±ÅŸÄ±labilir bÃ¶lÃ¼mÃ¼nÃ¼ bul
    const firstSectionNum = findNextStudySection(verbId, -1); // -1 ile en baÅŸtan ara
    if (firstSectionNum) {
        goToNextSection(firstSectionNum);
    } else {
        // Bu normalde olmamalÄ± ama olursa diye
        showView('verbMenu');
    }
}
/* ---------- AkÄ±llÄ± Ä°lerleme SONU ---------- */


/**
 * GÃœNCELLENDÄ° (v3.9): AkÄ±llÄ± Ä°lerleme
 * ArtÄ±k sonraki bÃ¶lÃ¼me, fiile veya hikayeye yÃ¶nlendirir.
 * Ortadaki 'MenÃ¼ye DÃ¶n' butonu kaldÄ±rÄ±ldÄ±.
 */
function showCompletion(){
  const t = getMergedTranslations(data.settings.language || 'tr');
  let scoreHtml = '';
  if (state.mode === 'study') {
      scoreHtml = `<p style="text-align:center">Bu bÃ¶lÃ¼mdeki ${state.deck.length} yeni kartÄ± Ã§alÄ±ÅŸtÄ±nÄ±z!</p>`;
  } else {
      scoreHtml = `<p style="text-align:center">"${state.tekrarStatus}" kategorisindeki ${state.deck.length} kartÄ± tekrar ettiniz!</p>`;
  }
  
  let completionButtonHtml = '';

  if (state.mode === 'study') {
      // 1. Sonraki BÃ¶lÃ¼mÃ¼ Ara
      const nextSectionNum = findNextStudySection(state.verb, state.section);
      if (nextSectionNum) {
          const sectionName = data.sections[nextSectionNum] || `BÃ¶lÃ¼m ${nextSectionNum}`;
          completionButtonHtml = `<button class="btn btn-primary" style="margin-top:10px; justify-content:center;" onclick="goToNextSection(${nextSectionNum})">â†’ Sonraki BÃ¶lÃ¼m: (${sectionName})</button>`;
      } else {
          // 2. Sonraki Fiili Ara
          const nextVerb = findNextStudyVerb(state.group, state.verb);
          if (nextVerb) {
              const verbName = nextVerb.verbTR || nextVerb.verbDE;
              completionButtonHtml = `<button class="btn btn-primary" style="margin-top:10px; justify-content:center;" onclick="goToNextVerb('${nextVerb.id}')">â†’ Sonraki Fiil: (${verbName})</button>`;
          } else {
              // 3. Hikayeyi Ara
              const groupData = data.groups.find(g => g.id === state.group);
              if (groupData && groupData.story && groupData.story.title) {
                  completionButtonHtml = `<button class="btn btn-warning" style="margin-top:10px; justify-content:center;" onclick="showGroupStory('${state.group}')">ğŸ‰ Grup Bitti! Hikayeye Git</button>`;
              }
          }
      }
  }

  document.getElementById('learningContent').innerHTML = `<div class="content-box"><h3 style="text-align:center">ğŸ‰ TamamladÄ±nÄ±z!</h3>
    ${scoreHtml}
    ${completionButtonHtml}
    </div>`;

  // YENÄ° (v3.9): Ä°stenildiÄŸi gibi, ortadaki ana aksiyon butonu artÄ±k gizleniyor.
  document.getElementById('actionBtn').style.display = 'none';
  
  document.getElementById('srsControls').style.display = 'none';
  updateProgress(state.deck.length, state.deck.length);
  // Dinle butonlarÄ±nÄ± kapat
  renderSentence(); 
}
function playCurrentSentence(lang, retryCount = 0) { /* ... deÄŸiÅŸiklik yok ... */ }

/* ---------- Hikaye FonksiyonlarÄ± ---------- */
function showGroupStory(groupId){ /* ... deÄŸiÅŸiklik yok ... */ }
function renderStoryContent(){ /* ... deÄŸiÅŸiklik yok ... */ }
function playStoryAudio(lang, retryCount = 0) { /* ... deÄŸiÅŸiklik yok ... */ }
function showStoryQuestions(){ /* ... deÄŸiÅŸiklik yok ... */ }
function checkStoryAnswers(){ /* ... deÄŸiÅŸiklik yok ... */ }

/* ---------- Debug & Ä°lerleme EkranÄ± ---------- */
function debugData(){ /* ... deÄŸiÅŸiklik yok ... */ }
function updateProgressView(){ /* ... deÄŸiÅŸiklik yok ... */ }
function toggleHintPanel(){
    state.hintPanelVisible = !state.hintPanelVisible;
    const hintPanelEl = document.getElementById('hintPanel');
    if(state.hintPanelVisible) {
        const hintHtml = buildSentenceHintHtml();
        hintPanelEl.innerHTML = hintHtml || '<div class="hint-item">Bu kart iÃ§in ipucu yok.</div>';
        hintPanelEl.style.display = 'block';
    } else {
        hintPanelEl.style.display = 'none';
    }
    // Paneli aÃ§Ä±nca, Ä°pucu ana panelini de aktif gÃ¶ster (v3.8)
    toggleLearningSubPanel('Hint');
}


/* ---------- Admin FonksiyonlarÄ± ---------- */
function showAdminGroupOrderForm(area) { /* ... deÄŸiÅŸiklik yok ... */ }
function renderGroupOrderList() { /* ... deÄŸiÅŸiklik yok ... */ }
function moveGroup(index, direction) { /* ... deÄŸiÅŸiklik yok ... */ }
function adminSaveGroupOrder() { /* ... deÄŸiÅŸiklik yok ... */ }
function showGroupVerbImporter() { /* ... deÄŸiÅŸiklik yok ... */ }
function parseAndImportGroupsAndVerbs() { /* ... deÄŸiÅŸiklik yok ... */ }
function showTsvImporter() { /* ... deÄŸiÅŸiklik yok ... */ }
function parseAndImportTsv() { /* ... deÄŸiÅŸiklik yok ... */ }
function showAdminForm(formType) { /* ... deÄŸiÅŸiklik yok ... */ }
function showAdminGroupForm(area) { /* ... deÄŸiÅŸiklik yok ... */ }
function adminSaveGroup() { /* ... deÄŸiÅŸiklik yok ... */ }
function adminDeleteGroup() { /* ... deÄŸiÅŸiklik yok ... */ }
function showAdminVerbForm(area) { /* ... deÄŸiÅŸiklik yok ... */ }
function adminLoadVerbFields() { /* ... deÄŸiÅŸiklik yok ... */ }
function adminSaveVerb() { /* ... deÄŸiÅŸiklik yok ... */ }
function adminDeleteVerb() { /* ... deÄŸiÅŸiklik yok ... */ }
function showAdminSectionForm(area) { /* ... deÄŸiÅŸiklik yok ... */ }
function adminSaveSection() { /* ... deÄŸiÅŸiklik yok ... */ }
function adminDeleteSection() { /* ... deÄŸiÅŸiklik yok ... */ }
function showAdminStoryForm(area) { /* ... deÄŸiÅŸiklik yok ... */ }
function adminStoryLoadFields() { /* ... deÄŸiÅŸiklik yok ... */ }
function adminStoryAddQuestion(q = null) { /* ... deÄŸiÅŸiklik yok ... */ }
function adminSaveStory() { /* ... deÄŸiÅŸiklik yok ... */ }
function showAdminHintForm(area) { /* ... deÄŸiÅŸiklik yok ... */ }
function adminHintLoadTargetSelectors() { /* ... deÄŸiÅŸiklik yok ... */ }
function adminHintLoadTargetSelectors_LoadSections() { /* ... deÄŸiÅŸiklik yok ... */ }
function adminHintLoadTargetSelectors_LoadSentences() { /* ... deÄŸiÅŸiklik yok ... */ }
function adminHintLoadText() { /* ... deÄŸiÅŸiklik yok ... */ }
function adminSaveHint() { /* ... deÄŸiÅŸiklik yok ... */ }
function showAdminSentenceForm(area) { /* ... deÄŸiÅŸiklik yok ... */ }
function fillSelect(id, items, addEmpty) { /* ... deÄŸiÅŸiklik yok ... */ }
function admin_es_loadVerbs() { /* ... deÄŸiÅŸiklik yok ... */ }
function admin_es_loadSections() { /* ... deÄŸiÅŸiklik yok ... */ }
function admin_es_loadSentences() { /* ... deÄŸiÅŸiklik yok ... */ }
function admin_es_loadSentenceFields() { /* ... deÄŸiÅŸiklik yok ... */ }
function adminSaveEditedSentence() { /* ... deÄŸiÅŸiklik yok ... */ }
function adminAddNewSentence() { /* ... deÄŸiÅŸiklik yok ... */ }
function adminDeleteSentence() { /* ... deÄŸiÅŸiklik yok ... */ }
function renderAllSentencesTable(){ /* ... deÄŸiÅŸiklik yok ... */ }
function exportSentencesCsv(){ /* ... deÄŸiÅŸiklik yok ... */ }
function forceUpdateApp() { /* ... deÄŸiÅŸiklik yok ... */ }

/* ---------- Utils ---------- */
function escapeHtml(t){ /* ... deÄŸiÅŸiklik yok ... */ }
function isObject(item) { /* ... deÄŸiÅŸiklik yok ... */ }
function deepMerge(target, source) { /* ... deÄŸiÅŸiklik yok ... */ }

/* ---------- BaÅŸlatma (Init v3.9) ---------- */
async function init(){
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('service-worker.js').then(reg => {
      console.log('SW kaydÄ± baÅŸarÄ±lÄ±: ', reg.scope);
    }, err => {
      console.log('SW kaydÄ± baÅŸarÄ±sÄ±z: ', err);
    });
  }
  if ('speechSynthesis' in window) {
    window.speechSynthesis.onvoiceschanged = () => console.log("TTS Sesleri yÃ¼klendi.");
    window.speechSynthesis.getVoices();
  }
  document.getElementById('modeToggleBtn').addEventListener('click', toggleNightMode);
  document.getElementById('nightModeToggle').addEventListener('change', toggleNightMode);
  document.getElementById('fileInput').onchange = importDataFromFile;
  document.getElementById('progressFileInput').onchange = importSrsData;

  musicPlayer = new MusicPlayer(
      './telifsiz-klasik.mp3',
      'musicVolumeSlider',
      'musicToggleBtn',
      'settingsMusicVolume',
      'settingsMusicToggle'
  );
  loadSettings();
  await loadDataFromServer();
  loadSrsData();
  updateConversionButtons();
  updateUITexts();
  updateProgressView();
  console.log('Verb Matrix v3.9 (AkÄ±llÄ± Ä°lerleme & BaÅŸlÄ±k) hazÄ±r.');
  showView('mainMenu');
}

window.addEventListener('DOMContentLoaded', init);

</script>
</body>
</html>
